{
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": {
          "type": "grafana",
          "uid": "-- Grafana --"
        },
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "description": "This dashboard estimates the cost of Vertex AI and Anthropic API calls in real-time. The cost values found on this dashboard ONLY correspond to the usage of the AI models. It does not account for VMs, Storage, or networking. For more details about the exact costs, please visit: https://lookerstudio.google.com/reporting/1e23952a-a508-4bd1-81f5-589a77e8f818/page/p_0bewxyeocd",
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 0,
  "id": null,
  "links": [

  ],
  "liveNow": true,
  "panels": [
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PA258B30F88C30650"
      },
      "gridPos": {
        "h": 9,
        "w": 24,
        "x": 0,
        "y": 0
      },
      "id": 5,
      "options": {
        "code": {
          "language": "plaintext",
          "showLineNumbers": false,
          "showMiniMap": false
        },
        "content": "# Dashboard Overview: Real-Time Cost Estimation for Vertex AI and Anthropic API Calls\n\nWelcome to the dashboard designed for monitoring the real-time cost estimates of Vertex AI and Anthropic API usage. Here's a quick guide to help you navigate and understand the displayed information:\n\n## Key Features:\n\n- **Real-Time Cost Estimation**: This dashboard provides up-to-date estimates of costs associated with the use of Vertex AI and Anthropic API services.\n- **AI Model Usage Focus**: Please note that the cost values displayed here are exclusive to the usage of AI models. This does not include expenses related to Virtual Machines (VMs), Storage, or Networking.\n\n## Detailed Cost Insights:\n\n- **Vertex AI Costs**: The cost information for Vertex AI is precise, as we accurately track the unit price per API request.\n- **Anthropic API Costs**: For Anthropic, the real-time metric available is the number of characters transmitted through the API. Since the unit price is based on the number of tokens, we calculate this by dividing the character count by a constant factor, currently set at 3.5 characters per token. This ratio can and will fluctuate over-time. This metric is +- 20% accurate until we refine that ratio.\n\n## Further Information:\n\nFor a more comprehensive breakdown of the exact costs and additional details, please visit our detailed report page: [Google Looker Studio Report](https://lookerstudio.google.com/reporting/1e23952a-a508-4bd1-81f5-589a77e8f818/page/p_0bewxyeocd).\n\n---",
        "mode": "markdown"
      },
      "pluginVersion": "10.1.5",
      "title": "Panel Title",
      "type": "text"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PA258B30F88C30650"
      },
      "description": "Cost of Codey Input usage on Vertex AI",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "fillOpacity": 80,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineWidth": 1,
            "scaleDistribution": {
              "type": "linear"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [

          ],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Value"
            },
            "properties": [
              {
                "id": "unit",
                "value": "currencyUSD"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "completions/completion/input"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "blue",
                  "mode": "fixed"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "completions/completion/output"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "super-light-blue",
                  "mode": "fixed"
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 18,
        "w": 12,
        "x": 0,
        "y": 9
      },
      "id": 1,
      "options": {
        "barRadius": 0,
        "barWidth": 0.95,
        "fullHighlight": false,
        "groupWidth": 0.69,
        "legend": {
          "calcs": [

          ],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "orientation": "auto",
        "showValue": "never",
        "stacking": "normal",
        "tooltip": {
          "mode": "multi",
          "sort": "none"
        },
        "xTickLabelRotation": -45,
        "xTickLabelSpacing": 100
      },
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "PA258B30F88C30650"
          },
          "editorMode": "code",
          "expr": "    sum by (vendor, item, unit, feature_category) (\n        increase(gitlab_cloud_cost_spend_entry_total{env=\"gprd\", vendor=\"vertex-ai\", item=\"completions/completion/input\"}[1m])\n    ) * 0.00041/1000",
          "format": "time_series",
          "instant": false,
          "interval": "60",
          "legendFormat": "{{item}}",
          "range": true,
          "refId": "A"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "PA258B30F88C30650"
          },
          "editorMode": "code",
          "exemplar": false,
          "expr": "    sum by (vendor, item, unit, feature_category) (\n        increase(gitlab_cloud_cost_spend_entry_total{env=\"gprd\", vendor=\"vertex-ai\", item=\"completions/completion/output\"}[1m])\n    ) * 0.00041/1000",
          "hide": false,
          "instant": false,
          "interval": "60",
          "legendFormat": "{{item}}",
          "range": true,
          "refId": "B"
        }
      ],
      "title": "Vertex AI - Codey - Cost",
      "transparent": true,
      "type": "barchart"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PA258B30F88C30650"
      },
      "description": "Cost of Codey Input usage on Vertex AI",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "fillOpacity": 80,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineWidth": 1,
            "scaleDistribution": {
              "type": "linear"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [

          ],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Value"
            },
            "properties": [
              {
                "id": "unit",
                "value": "currencyUSD"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "completions/completion/input"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "#cc785c",
                  "mode": "fixed"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "completions/completion/output"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "#ddd7cb",
                  "mode": "fixed"
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 18,
        "w": 12,
        "x": 12,
        "y": 9
      },
      "id": 3,
      "options": {
        "barRadius": 0,
        "barWidth": 0.95,
        "fullHighlight": false,
        "groupWidth": 0.7,
        "legend": {
          "calcs": [

          ],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "orientation": "auto",
        "showValue": "never",
        "stacking": "normal",
        "tooltip": {
          "mode": "multi",
          "sort": "none"
        },
        "xTickLabelRotation": -45,
        "xTickLabelSpacing": 100
      },
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "PA258B30F88C30650"
          },
          "editorMode": "code",
          "expr": "    sum by (vendor, item, unit, feature_category) (\n        increase(gitlab_cloud_cost_spend_entry_total{env=\"gprd\", vendor=\"anthropic\"}[1m])\n    ) / 3.5 * 8 /1000000",
          "format": "time_series",
          "instant": false,
          "interval": "60",
          "legendFormat": "{{item}}",
          "range": true,
          "refId": "A"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "PA258B30F88C30650"
          },
          "editorMode": "code",
          "exemplar": false,
          "expr": "    sum by (vendor, item, unit, feature_category) (\n        increase(gitlab_cloud_cost_spend_entry_total{env=\"gprd\", vendor=\"anthropic\", item=\"completions/completion/output\"}[10m])\n    ) * 0.00041/1000",
          "hide": true,
          "instant": false,
          "interval": "60",
          "legendFormat": "{{vendor}}",
          "range": true,
          "refId": "B"
        }
      ],
      "title": "Anthropic - Characters - Cost",
      "transparent": true,
      "type": "barchart"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PA258B30F88C30650"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [

          ],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Value"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "blue",
                  "mode": "fixed"
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 7,
        "w": 12,
        "x": 0,
        "y": 27
      },
      "id": 2,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "textMode": "auto"
      },
      "pluginVersion": "10.1.5",
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "PA258B30F88C30650"
          },
          "editorMode": "code",
          "expr": "sum(increase(gitlab_cloud_cost_spend_entry_total{env=\"gprd\", vendor=\"vertex-ai\", item=\"completions/completion/input\"}[$__range])) * 0.00041/1000",
          "hide": false,
          "instant": false,
          "legendFormat": "__auto",
          "range": true,
          "refId": "C"
        }
      ],
      "title": "Cost over selected period",
      "transparent": true,
      "type": "stat"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PA258B30F88C30650"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [

          ],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Value"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "#cc785c",
                  "mode": "fixed"
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 7,
        "w": 12,
        "x": 12,
        "y": 27
      },
      "id": 4,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "textMode": "auto"
      },
      "pluginVersion": "10.1.5",
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "PA258B30F88C30650"
          },
          "editorMode": "code",
          "expr": "sum(increase(gitlab_cloud_cost_spend_entry_total{env=\"gprd\", vendor=\"anthropic\", item=\"completions/completion/input\"}[$__range])) / 3.5 * 8 / 1000000",
          "hide": false,
          "instant": false,
          "legendFormat": "__auto",
          "range": true,
          "refId": "C"
        }
      ],
      "title": "Estimated Cost over selected period",
      "transparent": true,
      "type": "stat"
    }
  ],
  "refresh": "",
  "schemaVersion": 38,
  "style": "dark",
  "tags": [

  ],
  "templating": {
    "list": [

    ]
  },
  "time": {
    "from": "now-30m",
    "to": "now"
  },
  "timepicker": {
    "refresh_intervals": [
      "5m",
      "30m",
      "1h",
      "2h",
      "1d"
    ]
  },
  "timezone": "",
  "title": "Code Suggestions - Real-time Cost Estimation",
  "uid": "e0ca825e-923c-40f8-88f9-5935d9c5ffcd",
  "version": 11,
  "weekStart": "monday"
}