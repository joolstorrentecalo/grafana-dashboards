{"meta":{"type":"db","canSave":false,"canEdit":true,"canAdmin":false,"canStar":true,"slug":"sidekiq-worker-detail","url":"/d/sidekiq-worker-detail/sidekiq-worker-detail","expires":"0001-01-01T00:00:00Z","created":"2021-05-06T09:39:41Z","updated":"2021-06-09T16:11:13Z","updatedBy":"ops-contact@gitlab.com","createdBy":"ops-contact@gitlab.com","version":104,"hasAcl":false,"isFolder":false,"folderId":949,"folderTitle":"Sidekiq service","folderUrl":"/dashboards/f/sidekiq/sidekiq-service","provisioned":false,"provisionedExternalId":""},"dashboard":{"__inputs":[],"__requires":[],"annotations":{"list":[{"builtIn":1,"datasource":"-- Grafana --","enable":true,"hide":false,"iconColor":"#96D98D","name":"deploy","showIn":0,"tags":["deploy","$environment"],"type":"tags"},{"builtIn":1,"datasource":"-- Grafana --","enable":true,"hide":false,"iconColor":"#FFEE52","name":"canary-deploy","showIn":0,"tags":["deploy","${environment}-cny"],"type":"tags"},{"builtIn":1,"datasource":"-- Grafana --","enable":true,"hide":false,"iconColor":"#CA95E5","name":"feature-flags","showIn":0,"tags":["feature-flag","${environment}"],"type":"tags"}]},"description":"Uploaded by https://gitlab.com/gitlab-com/runbooks/-/jobs/1332401924 at Wed Jun  9 16:11:12 UTC 2021","editable":false,"gnetId":null,"graphTooltip":1,"hideControls":false,"id":null,"links":[{"asDropdown":true,"icon":"external link","includeVars":false,"keepTime":true,"tags":"","targetBlank":false,"title":"Platform Triage","type":"link","url":"https://dashboards.gitlab.net/d/general-triage/platform-triage?orgId=1"},{"asDropdown":true,"icon":"external link","includeVars":false,"keepTime":false,"tags":"","targetBlank":true,"title":"Logs: Sidekiq (servcat)","type":"link","url":"https://log.gprd.gitlab.net/goto/d7e4791e63d2a2b192514ac821c9f14f"},{"asDropdown":true,"icon":"external link","includeVars":false,"keepTime":false,"tags":"","targetBlank":true,"title":"Logs: Rails (servcat)","type":"link","url":"https://log.gprd.gitlab.net/goto/86fbcd537588abef69339a352ef81d72"},{"asDropdown":true,"icon":"external link","includeVars":false,"keepTime":false,"tags":"","targetBlank":true,"title":"Logs: Unicorn (servcat)","type":"link","url":"https://log.gprd.gitlab.net/goto/c87a39cf228c45ed8691c855aa583170"},{"asDropdown":true,"icon":"external link","includeVars":false,"keepTime":false,"tags":"","targetBlank":true,"title":"Logs: Unstructured (servcat)","type":"link","url":"https://console.cloud.google.com/logs/viewer?project=gitlab-production\u0026interval=PT1H\u0026resource=gce_instance\u0026advancedFilter=jsonPayload.hostname%3A%22sidekiq%22%0Alabels.tag%3D%22unstructured.production%22\u0026customFacets=labels.%22compute.googleapis.com%2Fresource_name%22"},{"asDropdown":true,"icon":"external link","includeVars":false,"keepTime":false,"tags":"","targetBlank":true,"title":"Logs: system (servcat)","type":"link","url":"https://log.gprd.gitlab.net/goto/72d0f3fdfd8db18db9800cc04d8b6f55"},{"asDropdown":true,"icon":"external link","includeVars":true,"keepTime":true,"tags":["managed","service overview"],"targetBlank":false,"title":"Service Overview Dashboards","type":"dashboards","url":""},{"asDropdown":true,"icon":"dashboard","includeVars":true,"keepTime":true,"tags":"type:sidekiq","targetBlank":false,"title":"Sidekiq Detail","type":"dashboards","url":""},{"asDropdown":true,"icon":"external link","includeVars":false,"keepTime":false,"tags":"","targetBlank":true,"title":"Find issues for $worker","type":"link","url":"https://gitlab.com/groups/gitlab-com/gl-infra/-/issues?scope=all\u0026state=all\u0026label_name[]=Service::Sidekiq\u0026search=$worker"}],"panels":[{"gridPos":{"h":4,"w":3.4285714285714284,"x":0,"y":0},"id":2,"links":[],"options":{"colorMode":"background","fieldOptions":{"calcs":["lastNotNull"],"defaults":{"links":[],"mappings":[{"from":"-10000000","id":0,"op":"=","text":"Urgency","to":"10000000","type":2,"value":"null"}],"nullValueMode":"connected","thresholds":{"mode":"absolute","steps":[{"color":"yellow","value":null}]},"title":"${__series.name}","unit":"none"},"overrides":[],"values":false},"graphMode":"none","justifyMode":"auto","orientation":"vertical"},"pluginVersion":"6.6.1","targets":[{"expr":"label_replace(\n  topk by (worker) (1, sum(rate(sidekiq_running_jobs{environment=\"$environment\", type=\"sidekiq\", stage=\"$stage\", worker=~\"$worker\"}[$__range])) by (worker, urgency)),\n  \"urgency\", \"unknown\", \"urgency\", \"\"\n)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":3,"legendFormat":"{{ urgency }} ({{ worker }})"}],"title":"Worker Attribute: Urgency","type":"stat"},{"gridPos":{"h":4,"w":3.4285714285714284,"x":3.4285714285714284,"y":0},"id":3,"links":[],"options":{"colorMode":"background","fieldOptions":{"calcs":["lastNotNull"],"defaults":{"links":[],"mappings":[{"from":"-10000000","id":0,"op":"=","text":"Feature Category","to":"10000000","type":2,"value":"null"}],"nullValueMode":"connected","thresholds":{"mode":"absolute","steps":[{"color":"blue","value":null}]},"title":"${__series.name}","unit":"none"},"overrides":[],"values":false},"graphMode":"none","justifyMode":"auto","orientation":"vertical"},"pluginVersion":"6.6.1","targets":[{"expr":"label_replace(\n  topk by (worker) (1, sum(rate(sidekiq_running_jobs{environment=\"$environment\", type=\"sidekiq\", stage=\"$stage\", worker=~\"$worker\"}[$__range])) by (worker, feature_category)),\n  \"feature_category\", \"unknown\", \"feature_category\", \"\"\n)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":3,"legendFormat":"{{ feature_category }} ({{ worker }})"}],"title":"Worker Attribute: Feature Category","type":"stat"},{"gridPos":{"h":4,"w":3.4285714285714284,"x":6.857142857142857,"y":0},"id":4,"links":[],"options":{"colorMode":"background","fieldOptions":{"calcs":["lastNotNull"],"defaults":{"links":[{"title":"Sidekiq Shard Detail: ${__field.label.shard}","url":"/d/sidekiq-shard-detail/sidekiq-shard-detail?orgId=1\u0026var-shard=${__field.label.shard}\u0026var-environment=${environment}\u0026var-stage=${stage}\u0026${__url_time_range}"}],"mappings":[{"from":"-10000000","id":0,"op":"=","text":"Shard","to":"10000000","type":2,"value":"null"}],"nullValueMode":"connected","thresholds":{"mode":"absolute","steps":[{"color":"orange","value":null}]},"title":"${__series.name}","unit":"none"},"overrides":[],"values":false},"graphMode":"none","justifyMode":"auto","orientation":"vertical"},"pluginVersion":"6.6.1","targets":[{"expr":"label_replace(\n  topk by (worker) (1, sum(rate(sidekiq_running_jobs{environment=\"$environment\", type=\"sidekiq\", stage=\"$stage\", worker=~\"$worker\"}[$__range])) by (worker, shard)),\n  \"shard\", \"unknown\", \"shard\", \"\"\n)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":3,"legendFormat":"{{ shard }} ({{ worker }})"}],"title":"Worker Attribute: Shard","type":"stat"},{"gridPos":{"h":4,"w":3.4285714285714284,"x":10.285714285714285,"y":0},"id":5,"links":[],"options":{"colorMode":"background","fieldOptions":{"calcs":["lastNotNull"],"defaults":{"links":[],"mappings":[{"from":"-10000000","id":0,"op":"=","text":"External Dependencies","to":"10000000","type":2,"value":"null"}],"nullValueMode":"connected","thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"title":"${__series.name}","unit":"none"},"overrides":[],"values":false},"graphMode":"none","justifyMode":"auto","orientation":"vertical"},"pluginVersion":"6.6.1","targets":[{"expr":"label_replace(\n  topk by (worker) (1, sum(rate(sidekiq_running_jobs{environment=\"$environment\", type=\"sidekiq\", stage=\"$stage\", worker=~\"$worker\"}[$__range])) by (worker, external_dependencies)),\n  \"external_dependencies\", \"none\", \"external_dependencies\", \"\"\n)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":3,"legendFormat":"{{ external_dependencies }} ({{ worker }})"}],"title":"Worker Attribute: External Dependencies","type":"stat"},{"gridPos":{"h":4,"w":3.4285714285714284,"x":13.714285714285714,"y":0},"id":6,"links":[],"options":{"colorMode":"background","fieldOptions":{"calcs":["lastNotNull"],"defaults":{"links":[],"mappings":[{"from":"-10000000","id":0,"op":"=","text":"Resource Boundary","to":"10000000","type":2,"value":"null"}],"nullValueMode":"connected","thresholds":{"mode":"absolute","steps":[{"color":"purple","value":null}]},"title":"${__series.name}","unit":"none"},"overrides":[],"values":false},"graphMode":"none","justifyMode":"auto","orientation":"vertical"},"pluginVersion":"6.6.1","targets":[{"expr":"label_replace(\n  topk by (worker) (1, sum(rate(sidekiq_running_jobs{environment=\"$environment\", type=\"sidekiq\", stage=\"$stage\", worker=~\"$worker\"}[$__range])) by (worker, boundary)),\n  \"boundary\", \"none\", \"boundary\", \"\"\n)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":3,"legendFormat":"{{ boundary }} ({{ worker }})"}],"title":"Worker Attribute: Resource Boundary","type":"stat"},{"gridPos":{"h":4,"w":3.4285714285714284,"x":17.142857142857142,"y":0},"id":7,"links":[],"options":{"colorMode":"background","fieldOptions":{"calcs":["lastNotNull"],"defaults":{"decimals":0,"links":[],"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"light-red","value":null}]},"title":"Max Queuing Duration SLO","unit":"s"},"overrides":[],"values":false},"graphMode":"none","justifyMode":"auto","orientation":"vertical"},"pluginVersion":"6.6.1","targets":[{"expr":"vector(NaN) and on () sidekiq_running_jobs{environment=\"$environment\", type=\"sidekiq\", stage=\"$stage\", worker=~\"$worker\", urgency=\"throttled\"}\nor\nvector(60.000000) and on () sidekiq_running_jobs{environment=\"$environment\", type=\"sidekiq\", stage=\"$stage\", worker=~\"$worker\", urgency=\"low\"}\nor\nvector(10.000000) and on () sidekiq_running_jobs{environment=\"$environment\", type=\"sidekiq\", stage=\"$stage\", worker=~\"$worker\", urgency=\"high\"}\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":3,"legendFormat":"{{ worker }}"}],"title":"Max Queuing Duration SLO","type":"stat"},{"gridPos":{"h":4,"w":3.4285714285714284,"x":20.57142857142857,"y":0},"id":8,"links":[],"options":{"colorMode":"background","fieldOptions":{"calcs":["lastNotNull"],"defaults":{"decimals":0,"links":[],"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"red","value":null}]},"title":"Max Execution Duration SLO","unit":"s"},"overrides":[],"values":false},"graphMode":"none","justifyMode":"auto","orientation":"vertical"},"pluginVersion":"6.6.1","targets":[{"expr":"vector(300.000000) and on () sidekiq_running_jobs{environment=\"$environment\", type=\"sidekiq\", stage=\"$stage\", worker=~\"$worker\", urgency=\"throttled\"}\nor\nvector(300.000000) and on () sidekiq_running_jobs{environment=\"$environment\", type=\"sidekiq\", stage=\"$stage\", worker=~\"$worker\", urgency=\"low\"}\nor\nvector(10.000000) and on () sidekiq_running_jobs{environment=\"$environment\", type=\"sidekiq\", stage=\"$stage\", worker=~\"$worker\", urgency=\"high\"}\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":3,"legendFormat":"{{ worker }}"}],"title":"Max Execution Duration SLO","type":"stat"},{"collapse":false,"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":100},"id":9,"panels":[],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"üå° Worker Key Metrics","titleSize":"h6","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"Queue apdex monitors the percentage of jobs that are dequeued within their queue threshold. Higher is better. Different jobs have different thresholds.","fill":0,"gridPos":{"h":8,"w":6,"x":0,"y":101},"id":750569445,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","options":{"dataLinks":[{"targetBlank":true,"title":"ElasticSearch: Sidekiq logs","url":"https://log.gprd.gitlab.net/app/kibana#/discover?_a=(columns:!(json.class,json.queue,json.meta.project,json.job_status,json.scheduling_latency_s,json.duration_s),filters:!((query:(match:(json.stage.keyword:(query:'$stage',type:phrase))))),index:'AWNABDRwNDuQHTm2tH6l',query:(language:kuery,query:'json.worker.keyword:${worker:lucene}'))\u0026_g=(time:(from:'${__from:date:iso}',to:'${__to:date:iso}'))"},{"targetBlank":true,"title":"ElasticSearch: queue latency visualization","url":"https://log.gprd.gitlab.net/app/kibana#/visualize/create?type=line\u0026indexPattern=AWNABDRwNDuQHTm2tH6l\u0026_a=(filters:!((query:(match:(json.stage.keyword:(query:'$stage',type:phrase))))),query:(language:kuery,query:'json.worker.keyword:${worker:lucene}'),vis:(aggs:!((enabled:!t,id:'1',params:(field:json.scheduling_latency_s,percents:!(95)),schema:metric,type:percentiles),(enabled:!t,id:'2',params:(drop_partials:!t,extended_bounds:(),field:json.time,interval:auto,min_doc_count:1,scaleMetricValues:!f,timeRange:(from:'${__from:date:iso}',to:'${__to:date:iso}'),useNormalizedEsInterval:!t),schema:segment,type:date_histogram)),params:(valueAxes:!((id:'ValueAxis-1',name:'LeftAxis-1',position:left,scale:(mode:normal,type:linear),show:!t,style:(),title:(text:'p95+Request+Duration:+json.scheduling_latency_s'),type:value)))))\u0026_g=(time:(from:'${__from:date:iso}',to:'${__to:date:iso}'))"}]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[{"alias":"/.* queue apdex$/","color":"#E7D551","zindex":3}],"spaceLength":10,"stableId":"queue-apdex","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_min(clamp_max(sum by (worker) (\n  (gitlab_background_jobs:queue:apdex:ratio_5m{environment=\"$environment\", worker=~\"$worker\"} \u003e= 0)\n  *\n  (gitlab_background_jobs:queue:apdex:weight:score_5m{environment=\"$environment\", worker=~\"$worker\"} \u003e= 0)\n)\n/\nsum by (worker) (\n  (gitlab_background_jobs:queue:apdex:weight:score_5m{environment=\"$environment\", worker=~\"$worker\"})\n)\n,1),0)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ worker }} queue apdex","refId":"A"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Queue Apdex","tooltip":{"shared":true,"sort":1,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"% Jobs within Max Queuing Duration SLO","logBase":1,"max":1,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"Execution apdex monitors the percentage of jobs that run within their execution (run-time) threshold. Higher is better. Different jobs have different thresholds.","fill":0,"gridPos":{"h":8,"w":6,"x":6,"y":101},"id":2504679775,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","options":{"dataLinks":[{"targetBlank":true,"title":"ElasticSearch: Sidekiq logs","url":"https://log.gprd.gitlab.net/app/kibana#/discover?_a=(columns:!(json.class,json.queue,json.meta.project,json.job_status,json.scheduling_latency_s,json.duration_s),filters:!((query:(match:(json.stage.keyword:(query:'$stage',type:phrase))))),index:'AWNABDRwNDuQHTm2tH6l',query:(language:kuery,query:'json.worker.keyword:${worker:lucene}'))\u0026_g=(time:(from:'${__from:date:iso}',to:'${__to:date:iso}'))"},{"targetBlank":true,"title":"ElasticSearch: execution latency visualization","url":"https://log.gprd.gitlab.net/app/kibana#/visualize/create?type=line\u0026indexPattern=AWNABDRwNDuQHTm2tH6l\u0026_a=(filters:!((query:(match:(json.stage.keyword:(query:'$stage',type:phrase))))),query:(language:kuery,query:'json.worker.keyword:${worker:lucene}'),vis:(aggs:!((enabled:!t,id:'1',params:(field:json.duration_s,percents:!(95)),schema:metric,type:percentiles),(enabled:!t,id:'2',params:(drop_partials:!t,extended_bounds:(),field:json.time,interval:auto,min_doc_count:1,scaleMetricValues:!f,timeRange:(from:'${__from:date:iso}',to:'${__to:date:iso}'),useNormalizedEsInterval:!t),schema:segment,type:date_histogram)),params:(valueAxes:!((id:'ValueAxis-1',name:'LeftAxis-1',position:left,scale:(mode:normal,type:linear),show:!t,style:(),title:(text:'p95+Request+Duration:+json.duration_s'),type:value)))))\u0026_g=(time:(from:'${__from:date:iso}',to:'${__to:date:iso}'))"}]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[{"alias":"/.* execution apdex$/","color":"#E7D551","zindex":3}],"spaceLength":10,"stableId":"execution-apdex","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_min(clamp_max(sum by (worker) (\n  (gitlab_background_jobs:execution:apdex:ratio_5m{environment=\"$environment\", worker=~\"$worker\"} \u003e= 0)\n  *\n  (gitlab_background_jobs:execution:apdex:weight:score_5m{environment=\"$environment\", worker=~\"$worker\"} \u003e= 0)\n)\n/\nsum by (worker) (\n  (gitlab_background_jobs:execution:apdex:weight:score_5m{environment=\"$environment\", worker=~\"$worker\"})\n)\n,1),0)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ worker }} execution apdex","refId":"A"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Execution Apdex","tooltip":{"shared":true,"sort":1,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"% Jobs within Max Execution Duration SLO","logBase":1,"max":1,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"Jobs executed per second","fill":0,"gridPos":{"h":8,"w":6,"x":12,"y":101},"id":3168042924,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","options":{"dataLinks":[{"targetBlank":true,"title":"ElasticSearch: Sidekiq logs","url":"https://log.gprd.gitlab.net/app/kibana#/discover?_a=(columns:!(json.class,json.queue,json.meta.project,json.job_status,json.scheduling_latency_s,json.duration_s),filters:!((query:(match:(json.stage.keyword:(query:'$stage',type:phrase))))),index:'AWNABDRwNDuQHTm2tH6l',query:(language:kuery,query:'json.worker.keyword:${worker:lucene}'))\u0026_g=(time:(from:'${__from:date:iso}',to:'${__to:date:iso}'))"},{"targetBlank":true,"title":"ElasticSearch: RPS visualization","url":"https://log.gprd.gitlab.net/app/kibana#/visualize/create?type=line\u0026indexPattern=AWNABDRwNDuQHTm2tH6l\u0026_a=(filters:!((query:(match:(json.stage.keyword:(query:'$stage',type:phrase))))),query:(language:kuery,query:'json.worker.keyword:${worker:lucene}'),vis:(aggs:!((enabled:!t,id:'1',params:(),schema:metric,type:count),(enabled:!t,id:'2',params:(drop_partials:!t,extended_bounds:(),field:json.time,interval:auto,min_doc_count:1,scaleMetricValues:!f,timeRange:(from:'${__from:date:iso}',to:'${__to:date:iso}'),useNormalizedEsInterval:!t),schema:segment,type:date_histogram))))\u0026_g=(time:(from:'${__from:date:iso}',to:'${__to:date:iso}'))"}]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[{"alias":"/.* rps$/","color":"#E7D551","zindex":3}],"spaceLength":10,"stableId":"request-rate","stack":false,"steppedLine":false,"targets":[{"expr":"sum by (worker) (gitlab_background_jobs:execution:ops:rate_5m{environment=\"$environment\", worker=~\"$worker\"})\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ worker }} rps","refId":"A"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Execution Rate (RPS)","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ops","label":"Jobs per Second","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Percentage of jobs that fail with an error. Lower is better.","fill":0,"gridPos":{"h":8,"w":6,"x":18,"y":101},"id":2383655193,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","options":{"dataLinks":[{"targetBlank":true,"title":"ElasticSearch: Sidekiq logs","url":"https://log.gprd.gitlab.net/app/kibana#/discover?_a=(columns:!(json.class,json.queue,json.meta.project,json.job_status,json.scheduling_latency_s,json.duration_s),filters:!((query:(match:(json.stage.keyword:(query:'$stage',type:phrase))))),index:'AWNABDRwNDuQHTm2tH6l',query:(language:kuery,query:'json.worker.keyword:${worker:lucene}'))\u0026_g=(time:(from:'${__from:date:iso}',to:'${__to:date:iso}'))"},{"targetBlank":true,"title":"ElasticSearch: errors visualization","url":"https://log.gprd.gitlab.net/app/kibana#/visualize/create?type=line\u0026indexPattern=AWNABDRwNDuQHTm2tH6l\u0026_a=(filters:!((query:(match:(json.stage.keyword:(query:'$stage',type:phrase)))),(query:(match:(json.job_status:(query:fail,type:phrase))))),query:(language:kuery,query:'json.worker.keyword:${worker:lucene}'),vis:(aggs:!((enabled:!t,id:'1',params:(),schema:metric,type:count),(enabled:!t,id:'2',params:(drop_partials:!t,extended_bounds:(),field:json.time,interval:auto,min_doc_count:1,scaleMetricValues:!f,timeRange:(from:'${__from:date:iso}',to:'${__to:date:iso}'),useNormalizedEsInterval:!t),schema:segment,type:date_histogram))))\u0026_g=(time:(from:'${__from:date:iso}',to:'${__to:date:iso}'))"}]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[{"alias":"/.* error ratio$/","color":"#E7D551","zindex":3}],"spaceLength":10,"stableId":"error-ratio","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_min(clamp_max(sum by (worker) (\n  (gitlab_background_jobs:execution:error:rate_5m{environment=\"$environment\", worker=~\"$worker\"} \u003e= 0)\n)\n/\nsum by (worker) (\n  (gitlab_background_jobs:execution:ops:rate_5m{environment=\"$environment\", worker=~\"$worker\"} \u003e= 0)\n)\n,1),0)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ worker }} error ratio","refId":"A"}],"thresholds":null,"timeFrom":null,"timeShift":null,"title":"Error Ratio","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"Error Percentage","logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"collapse":false,"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":201},"id":14,"panels":[],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"Queue Latency (the amount of time spent queueing)","titleSize":"h6","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"","fill":0,"gridPos":{"h":10,"w":24,"x":0,"y":202},"id":15,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"histogram_quantile(0.95, sum by (worker, le) (\n  sli_aggregations:sidekiq_jobs_queue_duration_seconds_bucket_rate5m{environment=\"$environment\",stage=\"$stage\",type=\"sidekiq\",worker=~\"$worker\"}\n))\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"p95 {{ worker }}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Queue Time","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"s","label":"Duration","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"collapse":false,"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":301},"id":16,"panels":[],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"Execution Latency (the amount of time the job takes to execute after dequeue)","titleSize":"h6","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"","fill":0,"gridPos":{"h":10,"w":24,"x":0,"y":302},"id":17,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"histogram_quantile(0.95, sum by (worker, le) (\n  sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate5m{environment=\"$environment\",stage=\"$stage\",type=\"sidekiq\",worker=~\"$worker\"}\n))\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"p95 {{ worker }}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Execution Time","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"s","label":"Duration","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"collapse":false,"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":401},"id":18,"panels":[],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"Execution RPS (the rate at which jobs are completed after dequeue)","titleSize":"h6","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"","fill":0,"gridPos":{"h":10,"w":24,"x":0,"y":402},"id":19,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by (worker) (\n  gitlab_background_jobs:execution:ops:rate_5m{environment=\"$environment\", worker=~\"$worker\"}\n)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ worker }}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"RPS","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"collapse":false,"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":501},"id":20,"panels":[],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"Error Rate (the rate at which jobs fail)","titleSize":"h6","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"","fill":0,"gridPos":{"h":10,"w":12,"x":0,"y":502},"id":21,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by (worker) (\n  gitlab_background_jobs:execution:error:rate_5m{environment=\"$environment\", worker=~\"$worker\"}\n)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ worker }}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Errors","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"","fill":0,"gridPos":{"h":10,"w":12,"x":12,"y":502},"id":22,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by (worker) (\n  increase(sidekiq_jobs_dead_total{environment=\"$environment\",stage=\"$stage\",type=\"sidekiq\",worker=~\"$worker\"}[5m])\n)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ worker }}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Dead Jobs","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"collapse":false,"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":601},"id":23,"panels":[],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"Resource Usage","titleSize":"h6","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"","fill":0,"gridPos":{"h":10,"w":8,"x":0,"y":602},"id":24,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"histogram_quantile(0.5, sum by (worker, le) (\n  rate(sidekiq_jobs_cpu_seconds_bucket{environment=\"$environment\",stage=\"$stage\",type=\"sidekiq\",worker=~\"$worker\"}[$__interval])\n))\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ worker }} p50","refId":"A"},{"expr":"histogram_quantile(0.9, sum by (worker, le) (\n  rate(sidekiq_jobs_cpu_seconds_bucket{environment=\"$environment\",stage=\"$stage\",type=\"sidekiq\",worker=~\"$worker\"}[$__interval])\n))\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ worker }} p90","refId":"B"},{"expr":"histogram_quantile(0.95, sum by (worker, le) (\n  rate(sidekiq_jobs_cpu_seconds_bucket{environment=\"$environment\",stage=\"$stage\",type=\"sidekiq\",worker=~\"$worker\"}[$__interval])\n))\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ worker }} p95","refId":"C"},{"expr":"histogram_quantile(0.99, sum by (worker, le) (\n  rate(sidekiq_jobs_cpu_seconds_bucket{environment=\"$environment\",stage=\"$stage\",type=\"sidekiq\",worker=~\"$worker\"}[$__interval])\n))\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ worker }} p99","refId":"D"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"CPU Time","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"s","label":"Duration","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"","fill":0,"gridPos":{"h":10,"w":8,"x":8,"y":602},"id":25,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"histogram_quantile(0.5, sum by (worker, le) (\n  rate(sidekiq_jobs_gitaly_seconds_bucket{environment=\"$environment\",stage=\"$stage\",type=\"sidekiq\",worker=~\"$worker\"}[$__interval])\n))\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ worker }} p50","refId":"A"},{"expr":"histogram_quantile(0.9, sum by (worker, le) (\n  rate(sidekiq_jobs_gitaly_seconds_bucket{environment=\"$environment\",stage=\"$stage\",type=\"sidekiq\",worker=~\"$worker\"}[$__interval])\n))\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ worker }} p90","refId":"B"},{"expr":"histogram_quantile(0.95, sum by (worker, le) (\n  rate(sidekiq_jobs_gitaly_seconds_bucket{environment=\"$environment\",stage=\"$stage\",type=\"sidekiq\",worker=~\"$worker\"}[$__interval])\n))\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ worker }} p95","refId":"C"},{"expr":"histogram_quantile(0.99, sum by (worker, le) (\n  rate(sidekiq_jobs_gitaly_seconds_bucket{environment=\"$environment\",stage=\"$stage\",type=\"sidekiq\",worker=~\"$worker\"}[$__interval])\n))\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ worker }} p99","refId":"D"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Gitaly Time","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"s","label":"Duration","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"","fill":0,"gridPos":{"h":10,"w":8,"x":16,"y":602},"id":26,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"histogram_quantile(0.5, sum by (worker, le) (\n  rate(sidekiq_jobs_db_seconds_bucket{environment=\"$environment\",stage=\"$stage\",type=\"sidekiq\",worker=~\"$worker\"}[$__interval])\n))\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ worker }} p50","refId":"A"},{"expr":"histogram_quantile(0.9, sum by (worker, le) (\n  rate(sidekiq_jobs_db_seconds_bucket{environment=\"$environment\",stage=\"$stage\",type=\"sidekiq\",worker=~\"$worker\"}[$__interval])\n))\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ worker }} p90","refId":"B"},{"expr":"histogram_quantile(0.95, sum by (worker, le) (\n  rate(sidekiq_jobs_db_seconds_bucket{environment=\"$environment\",stage=\"$stage\",type=\"sidekiq\",worker=~\"$worker\"}[$__interval])\n))\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ worker }} p95","refId":"C"},{"expr":"histogram_quantile(0.99, sum by (worker, le) (\n  rate(sidekiq_jobs_db_seconds_bucket{environment=\"$environment\",stage=\"$stage\",type=\"sidekiq\",worker=~\"$worker\"}[$__interval])\n))\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ worker }} p99","refId":"D"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Database Time","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"s","label":"Duration","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"","fill":0,"gridPos":{"h":10,"w":8,"x":0,"y":603},"id":27,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"histogram_quantile(0.5, sum by (worker, le) (\n  rate(sidekiq_redis_requests_duration_seconds_bucket{environment=\"$environment\",stage=\"$stage\",type=\"sidekiq\",worker=~\"$worker\"}[$__interval])\n))\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ worker }} p50","refId":"A"},{"expr":"histogram_quantile(0.9, sum by (worker, le) (\n  rate(sidekiq_redis_requests_duration_seconds_bucket{environment=\"$environment\",stage=\"$stage\",type=\"sidekiq\",worker=~\"$worker\"}[$__interval])\n))\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ worker }} p90","refId":"B"},{"expr":"histogram_quantile(0.95, sum by (worker, le) (\n  rate(sidekiq_redis_requests_duration_seconds_bucket{environment=\"$environment\",stage=\"$stage\",type=\"sidekiq\",worker=~\"$worker\"}[$__interval])\n))\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ worker }} p95","refId":"C"},{"expr":"histogram_quantile(0.99, sum by (worker, le) (\n  rate(sidekiq_redis_requests_duration_seconds_bucket{environment=\"$environment\",stage=\"$stage\",type=\"sidekiq\",worker=~\"$worker\"}[$__interval])\n))\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ worker }} p99","refId":"D"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Redis Time","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"s","label":"Duration","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"","fill":0,"gridPos":{"h":10,"w":8,"x":8,"y":603},"id":28,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"histogram_quantile(0.5, sum by (worker, le) (\n  rate(sidekiq_elasticsearch_requests_duration_seconds_bucket{environment=\"$environment\",stage=\"$stage\",type=\"sidekiq\",worker=~\"$worker\"}[$__interval])\n))\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ worker }} p50","refId":"A"},{"expr":"histogram_quantile(0.9, sum by (worker, le) (\n  rate(sidekiq_elasticsearch_requests_duration_seconds_bucket{environment=\"$environment\",stage=\"$stage\",type=\"sidekiq\",worker=~\"$worker\"}[$__interval])\n))\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ worker }} p90","refId":"B"},{"expr":"histogram_quantile(0.95, sum by (worker, le) (\n  rate(sidekiq_elasticsearch_requests_duration_seconds_bucket{environment=\"$environment\",stage=\"$stage\",type=\"sidekiq\",worker=~\"$worker\"}[$__interval])\n))\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ worker }} p95","refId":"C"},{"expr":"histogram_quantile(0.99, sum by (worker, le) (\n  rate(sidekiq_elasticsearch_requests_duration_seconds_bucket{environment=\"$environment\",stage=\"$stage\",type=\"sidekiq\",worker=~\"$worker\"}[$__interval])\n))\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ worker }} p99","refId":"D"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Elasticsearch Time","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"s","label":"Duration","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"collapse":false,"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":701},"id":29,"panels":[],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"SQL","titleSize":"h6","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"","fill":0,"gridPos":{"h":10,"w":8,"x":0,"y":702},"id":1266521010,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stableId":"total-sql-queries-rate","stack":false,"steppedLine":false,"targets":[{"expr":"sum by (endpoint_id) (\n  rate(\n    gitlab_transaction_db_count_total{endpoint_id=~\"$worker\",environment=\"$environment\",stage=\"$stage\",type=\"sidekiq\"}[$__interval]\n  )\n)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ endpoint_id }} - total","refId":"A"},{"expr":"sum by (endpoint_id) (\n  rate(\n    gitlab_transaction_db_primary_count_total{endpoint_id=~\"$worker\",environment=\"$environment\",stage=\"$stage\",type=\"sidekiq\"}[$__interval]\n  )\n)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ endpoint_id }} - primary","refId":"B"},{"expr":"sum by (endpoint_id) (\n  rate(\n    gitlab_transaction_db_replica_count_total{endpoint_id=~\"$worker\",environment=\"$environment\",stage=\"$stage\",type=\"sidekiq\"}[$__interval]\n  )\n)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ endpoint_id }} - replica","refId":"C"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Total SQL Queries Rate","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ops","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"","fill":0,"gridPos":{"h":10,"w":8,"x":8,"y":702},"id":260857907,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stableId":"sql-transaction","stack":false,"steppedLine":false,"targets":[{"expr":"sum by (endpoint_id) (\n  rate(gitlab_database_transaction_seconds_count{endpoint_id=~\"$worker\",environment=\"$environment\",stage=\"$stage\",type=\"sidekiq\"}[$__interval])\n)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ endpoint_id }}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"SQL Transactions Rate","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"","fill":0,"gridPos":{"h":10,"w":8,"x":16,"y":702},"id":3344517543,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stableId":"sql-transaction-holding-duration","stack":false,"steppedLine":false,"targets":[{"expr":"sum(rate(gitlab_database_transaction_seconds_sum{endpoint_id=~\"$worker\",environment=\"$environment\",stage=\"$stage\",type=\"sidekiq\"}[$__interval])) by (endpoint_id)\n/\nsum(rate(gitlab_database_transaction_seconds_count{endpoint_id=~\"$worker\",environment=\"$environment\",stage=\"$stage\",type=\"sidekiq\"}[$__interval])) by (endpoint_id)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ endpoint_id }} - p50","refId":"A"},{"expr":"histogram_quantile(0.95, sum(rate(gitlab_database_transaction_seconds_bucket{endpoint_id=~\"$worker\",environment=\"$environment\",stage=\"$stage\",type=\"sidekiq\"}[$__interval])) by (endpoint_id, le))\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ endpoint_id }} - p95","refId":"B"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"SQL Transaction Holding Duration","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"s","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"content":"Made with ‚ù§Ô∏è and [Grafonnet](https://github.com/grafana/grafonnet-lib). [Contribute to this dashboard on GitLab.com](https://gitlab.com/gitlab-com/runbooks/blob/master/dashboards/./sidekiq/worker-detail.dashboard.jsonnet)\n","datasource":null,"gridPos":{"h":2,"w":24,"x":0,"y":110000},"id":33,"mode":"markdown","title":"Source","type":"text"}],"refresh":"","rows":[],"schemaVersion":16,"style":"light","tags":["managed","sidekiq","type:sidekiq","detail"],"templating":{"list":[{"current":{"text":"Global","value":"Global"},"hide":0,"label":null,"name":"PROMETHEUS_DS","options":[],"query":"prometheus","refresh":1,"regex":"/(.*-gprd|Frank|Global|gprd-.*)/","type":"datasource"},{"allValue":null,"current":{"text":"gprd","value":"gprd"},"datasource":"$PROMETHEUS_DS","hide":0,"includeAll":false,"label":null,"multi":false,"name":"environment","options":[],"query":"label_values(gitlab_service_ops:rate, environment)","refresh":1,"regex":"","sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":null,"current":{"text":"main","value":"main"},"hide":0,"includeAll":false,"label":"","multi":false,"name":"stage","options":[{"text":"main","value":"main"},{"text":"cny","value":"cny"},{"text":"","value":""}],"query":"main,cny,","refresh":0,"type":"custom"},{"allValue":".*","current":{"text":"PostReceive","value":"PostReceive"},"datasource":"$PROMETHEUS_DS","hide":0,"includeAll":true,"label":null,"multi":true,"name":"worker","options":[],"query":"label_values(sidekiq_jobs_completion_seconds_count{environment=\"$environment\", type=\"sidekiq\"}, worker)","refresh":1,"regex":"","sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false}]},"time":{"from":"now-6h/m","to":"now/m"},"timepicker":{"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"utc","title":"sidekiq: Worker Detail","uid":"sidekiq-worker-detail","version":104}}