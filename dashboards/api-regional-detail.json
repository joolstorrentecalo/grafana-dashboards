{"meta":{"type":"db","canSave":false,"canEdit":true,"canAdmin":false,"canStar":true,"slug":"api-regional-detail","url":"/d/api-regional/api-regional-detail","expires":"0001-01-01T00:00:00Z","created":"2021-02-11T20:39:46Z","updated":"2021-09-13T22:16:29Z","updatedBy":"ops-contact@gitlab.com","createdBy":"ops-contact@gitlab.com","version":610,"hasAcl":false,"isFolder":false,"folderId":947,"folderTitle":"API Service","folderUrl":"/dashboards/f/api/api-service","provisioned":false,"provisionedExternalId":""},"dashboard":{"__inputs":[],"__requires":[],"annotations":{"list":[{"builtIn":1,"datasource":"-- Grafana --","enable":false,"hide":false,"iconColor":"#96D98D","name":"deploy","showIn":0,"tags":["deploy","$environment"],"type":"tags"},{"builtIn":1,"datasource":"-- Grafana --","enable":false,"hide":false,"iconColor":"#FFEE52","name":"canary-deploy","showIn":0,"tags":["deploy","${environment}-cny"],"type":"tags"},{"builtIn":1,"datasource":"-- Grafana --","enable":false,"hide":false,"iconColor":"#CA95E5","name":"feature-flags","showIn":0,"tags":["feature-flag","${environment}"],"type":"tags"}]},"description":"Uploaded by https://gitlab.com/gitlab-com/runbooks/-/jobs/1586786336 at Mon Sep 13 22:16:28 UTC 2021","editable":false,"gnetId":null,"graphTooltip":1,"hideControls":false,"id":null,"links":[],"panels":[{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Apdex is a measure of requests that complete within a tolerable period of time for the service. Higher is better.","fill":0,"gridPos":{"h":8,"w":8,"x":0,"y":10},"id":3009519636,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"nullPointMode":"null","options":{"dataLinks":[{"targetBlank":true,"title":"Regional Service Aggregated  Apdex SLO Analysis","url":"/d/alerts-service_regional_slo_apdex?${__url_time_range}\u0026${__all_variables}\u0026var-type=api\u0026var-stage=$stage"}]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"6h Degradation SLO (5% of monthly error budget)","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"1h Outage SLO (2% of monthly error budget)","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"SLO","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2}],"spaceLength":10,"stableId":"service-regional-api-apdex","stack":false,"steppedLine":false,"targets":[{"expr":"min_over_time(gitlab_service_regional_apdex:ratio_5m{env=\"$environment\",environment=\"$environment\",monitor=\"global\",stage=\"$stage\",type=\"api\"}[$__interval])\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ region }} apdex","refId":"A"},{"expr":"(1 - 6 * (1 - avg(slo:min:events:gitlab_service_apdex:ratio{monitor=\"global\",type=\"api\"})))\n","format":"time_series","interval":"5m","intervalFactor":3,"legendFormat":"6h Degradation SLO (5% of monthly error budget)","refId":"B"},{"expr":"(1 - 14.4 * (1 - avg(slo:min:events:gitlab_service_apdex:ratio{monitor=\"global\",type=\"api\"})))\n","format":"time_series","interval":"5m","intervalFactor":3,"legendFormat":"1h Outage SLO (2% of monthly error budget)","refId":"C"}],"title":"Regional Service Aggregated  Apdex","tooltip":{"shared":true,"sort":1,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"percentunit","label":"Apdex %","logBase":1,"max":1,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Error rates are a measure of unhandled service exceptions per second. Client errors are excluded when possible. Lower is better","fill":0,"gridPos":{"h":8,"w":8,"x":8,"y":10},"id":1799202405,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"nullPointMode":"null","options":{"dataLinks":[{"targetBlank":true,"title":"Regional Service Aggregated  Error-Rate SLO Analysis","url":"/d/alerts-service_regional_slo_error?${__url_time_range}\u0026${__all_variables}\u0026var-type=api\u0026var-stage=$stage"}]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"6h Degradation SLO (5% of monthly error budget)","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"1h Outage SLO (2% of monthly error budget)","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2}],"spaceLength":10,"stableId":"service-regional-api-error-rate","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_max(\n  max_over_time(gitlab_service_regional_errors:ratio_5m{env=\"$environment\",environment=\"$environment\",monitor=\"global\",stage=\"$stage\",type=\"api\"}[$__interval])\n,\n  1\n)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ region }} error ratio","refId":"A"},{"expr":"(6 * avg(slo:max:events:gitlab_service_errors:ratio{monitor=\"global\",type=\"api\"}))\n","format":"time_series","interval":"5m","intervalFactor":3,"legendFormat":"6h Degradation SLO (5% of monthly error budget)","refId":"B"},{"expr":"(14.4 * avg(slo:max:events:gitlab_service_errors:ratio{monitor=\"global\",type=\"api\"}))\n","format":"time_series","interval":"5m","intervalFactor":3,"legendFormat":"1h Outage SLO (2% of monthly error budget)","refId":"C"}],"title":"Regional Service Aggregated  Error Ratio","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"percentunit","label":"Error %","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"The operation rate is the sum total of all requests being handle for all components within this service. Note that a single user request can lead to requests to multiple components. Higher is busier.","fill":0,"gridPos":{"h":8,"w":8,"x":16,"y":10},"id":1946800564,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stableId":"service-regional-api-ops-rate","stack":false,"steppedLine":false,"targets":[{"expr":"avg_over_time(gitlab_service_regional_ops:rate_5m{env=\"$environment\",environment=\"$environment\",monitor=\"global\",stage=\"$stage\",type=\"api\"}[$__interval])\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ region }} RPS","refId":"A"}],"title":"Regional Service Aggregated  RPS - Requests per Second","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Operations per Second","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"collapse":false,"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":1000},"id":5,"panels":[],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"üî¨ Regional SLIs","titleSize":"h6","type":"row"},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Error rates are a measure of unhandled service exceptions per second. Client errors are excluded when possible. Lower is better","fill":0,"gridPos":{"h":8,"w":8,"x":0,"y":1001},"id":3255520955,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"nullPointMode":"null","options":{"dataLinks":[{"targetBlank":true,"title":"loadbalancer SLI Error-Rate SLO Analysis","url":"/d/alerts-regional_component_slo_error?${__url_time_range}\u0026${__all_variables}\u0026var-component=loadbalancer\u0026var-type=api\u0026var-stage=$stage"}]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"6h Degradation SLO (5% of monthly error budget)","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"1h Outage SLO (2% of monthly error budget)","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2}],"spaceLength":10,"stableId":"sli-loadbalancer-error-rate","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_max(\n  max_over_time(gitlab_regional_sli_errors:ratio_5m{component=\"loadbalancer\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",stage=\"$stage\",type=\"api\"}[$__interval])\n,\n  1\n)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ region }} error ratio","refId":"A"},{"expr":"(6 * avg(slo:max:events:gitlab_service_errors:ratio{monitor=\"global\",type=\"api\"}))\n","format":"time_series","interval":"5m","intervalFactor":3,"legendFormat":"6h Degradation SLO (5% of monthly error budget)","refId":"B"},{"expr":"(14.4 * avg(slo:max:events:gitlab_service_errors:ratio{monitor=\"global\",type=\"api\"}))\n","format":"time_series","interval":"5m","intervalFactor":3,"legendFormat":"1h Outage SLO (2% of monthly error budget)","refId":"C"}],"title":"loadbalancer SLI Error Ratio","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"percentunit","label":"Error %","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"The operation rate is the sum total of all requests being handle for all components within this service. Note that a single user request can lead to requests to multiple components. Higher is busier.","fill":0,"gridPos":{"h":8,"w":8,"x":8,"y":1001},"id":138982496,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stableId":"sli-loadbalancer-ops-rate","stack":false,"steppedLine":false,"targets":[{"expr":"avg_over_time(gitlab_regional_sli_ops:rate_5m{component=\"loadbalancer\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",stage=\"$stage\",type=\"api\"}[$__interval])\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ region }} RPS","refId":"A"}],"title":"loadbalancer SLI RPS - Requests per Second","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Operations per Second","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"content":"### Description\n\nMeasures aggregated HTTP request traffic through the HAProxy.\n5xx responses are considered to be failures.\n\n\n\n### Observability Tools\n\n* [BigQuery: Main-stage: top paths for 5xx errors](https://console.cloud.google.com/bigquery?project=gitlab-production\u0026sq=805818759045:342973e81d4a481d8055b43564d09728)\n\n","gridPos":{"h":8,"w":8,"x":16,"y":1001},"id":8,"mode":"markdown","title":"Details","type":"text"},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Error rates are a measure of unhandled service exceptions per second. Client errors are excluded when possible. Lower is better","fill":0,"gridPos":{"h":8,"w":8,"x":0,"y":1011},"id":1425819584,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"nullPointMode":"null","options":{"dataLinks":[{"targetBlank":true,"title":"nginx_ingress SLI Error-Rate SLO Analysis","url":"/d/alerts-regional_component_slo_error?${__url_time_range}\u0026${__all_variables}\u0026var-component=nginx_ingress\u0026var-type=api\u0026var-stage=$stage"}]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"6h Degradation SLO (5% of monthly error budget)","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"1h Outage SLO (2% of monthly error budget)","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2}],"spaceLength":10,"stableId":"sli-nginx_ingress-error-rate","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_max(\n  max_over_time(gitlab_regional_sli_errors:ratio_5m{component=\"nginx_ingress\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",stage=\"$stage\",type=\"api\"}[$__interval])\n,\n  1\n)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ region }} error ratio","refId":"A"},{"expr":"(6 * avg(slo:max:events:gitlab_service_errors:ratio{monitor=\"global\",type=\"api\"}))\n","format":"time_series","interval":"5m","intervalFactor":3,"legendFormat":"6h Degradation SLO (5% of monthly error budget)","refId":"B"},{"expr":"(14.4 * avg(slo:max:events:gitlab_service_errors:ratio{monitor=\"global\",type=\"api\"}))\n","format":"time_series","interval":"5m","intervalFactor":3,"legendFormat":"1h Outage SLO (2% of monthly error budget)","refId":"C"}],"title":"nginx_ingress SLI Error Ratio","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"percentunit","label":"Error %","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"The operation rate is the sum total of all requests being handle for all components within this service. Note that a single user request can lead to requests to multiple components. Higher is busier.","fill":0,"gridPos":{"h":8,"w":8,"x":8,"y":1011},"id":2358192786,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stableId":"sli-nginx_ingress-ops-rate","stack":false,"steppedLine":false,"targets":[{"expr":"avg_over_time(gitlab_regional_sli_ops:rate_5m{component=\"nginx_ingress\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",stage=\"$stage\",type=\"api\"}[$__interval])\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ region }} RPS","refId":"A"}],"title":"nginx_ingress SLI RPS - Requests per Second","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Operations per Second","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"content":"### Description\n\nnginx for api\n\n\n\n### Observability Tools\n\n\n","gridPos":{"h":8,"w":8,"x":16,"y":1011},"id":11,"mode":"markdown","title":"Details","type":"text"},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Apdex is a measure of requests that complete within a tolerable period of time for the service. Higher is better.","fill":0,"gridPos":{"h":8,"w":6,"x":0,"y":1021},"id":561966508,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"nullPointMode":"null","options":{"dataLinks":[{"targetBlank":true,"title":"puma SLI Apdex SLO Analysis","url":"/d/alerts-regional_component_slo_apdex?${__url_time_range}\u0026${__all_variables}\u0026var-component=puma\u0026var-type=api\u0026var-stage=$stage"}]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"6h Degradation SLO (5% of monthly error budget)","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"1h Outage SLO (2% of monthly error budget)","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"SLO","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2}],"spaceLength":10,"stableId":"sli-puma-apdex","stack":false,"steppedLine":false,"targets":[{"expr":"min_over_time(gitlab_regional_sli_apdex:ratio_5m{component=\"puma\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",stage=\"$stage\",type=\"api\"}[$__interval])\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ region }} apdex","refId":"A"},{"expr":"(1 - 6 * (1 - avg(slo:min:events:gitlab_service_apdex:ratio{monitor=\"global\",type=\"api\"})))\n","format":"time_series","interval":"5m","intervalFactor":3,"legendFormat":"6h Degradation SLO (5% of monthly error budget)","refId":"B"},{"expr":"(1 - 14.4 * (1 - avg(slo:min:events:gitlab_service_apdex:ratio{monitor=\"global\",type=\"api\"})))\n","format":"time_series","interval":"5m","intervalFactor":3,"legendFormat":"1h Outage SLO (2% of monthly error budget)","refId":"C"}],"title":"puma SLI Apdex","tooltip":{"shared":true,"sort":1,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"percentunit","label":"Apdex %","logBase":1,"max":1,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Error rates are a measure of unhandled service exceptions per second. Client errors are excluded when possible. Lower is better","fill":0,"gridPos":{"h":8,"w":6,"x":6,"y":1021},"id":2425637513,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"nullPointMode":"null","options":{"dataLinks":[{"targetBlank":true,"title":"puma SLI Error-Rate SLO Analysis","url":"/d/alerts-regional_component_slo_error?${__url_time_range}\u0026${__all_variables}\u0026var-component=puma\u0026var-type=api\u0026var-stage=$stage"}]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"6h Degradation SLO (5% of monthly error budget)","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"1h Outage SLO (2% of monthly error budget)","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2}],"spaceLength":10,"stableId":"sli-puma-error-rate","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_max(\n  max_over_time(gitlab_regional_sli_errors:ratio_5m{component=\"puma\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",stage=\"$stage\",type=\"api\"}[$__interval])\n,\n  1\n)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ region }} error ratio","refId":"A"},{"expr":"(6 * avg(slo:max:events:gitlab_service_errors:ratio{monitor=\"global\",type=\"api\"}))\n","format":"time_series","interval":"5m","intervalFactor":3,"legendFormat":"6h Degradation SLO (5% of monthly error budget)","refId":"B"},{"expr":"(14.4 * avg(slo:max:events:gitlab_service_errors:ratio{monitor=\"global\",type=\"api\"}))\n","format":"time_series","interval":"5m","intervalFactor":3,"legendFormat":"1h Outage SLO (2% of monthly error budget)","refId":"C"}],"title":"puma SLI Error Ratio","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"percentunit","label":"Error %","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"The operation rate is the sum total of all requests being handle for all components within this service. Note that a single user request can lead to requests to multiple components. Higher is busier.","fill":0,"gridPos":{"h":8,"w":6,"x":12,"y":1021},"id":110019945,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stableId":"sli-puma-ops-rate","stack":false,"steppedLine":false,"targets":[{"expr":"avg_over_time(gitlab_regional_sli_ops:rate_5m{component=\"puma\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",stage=\"$stage\",type=\"api\"}[$__interval])\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ region }} RPS","refId":"A"}],"title":"puma SLI RPS - Requests per Second","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Operations per Second","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"content":"### Description\n\nThis SLI monitors API traffic in aggregate, in the GitLab rails monolith, via its\nHTTP interface. 5xx responses are treated as failures.\n\n\n\n### Observability Tools\n\n* [üêû Sentry Releases: gitlab/gitlabcom](https://sentry.gitlab.net/gitlab/gitlabcom/releases?environment=${environment})\n* [üêû Sentry api issues](https://sentry.gitlab.net/gitlab/gitlabcom/issues?environment=${environment}\u0026query=stage%3A${stage}+type%3Aapi)\n* [üìñ Kibana: Rails logs](https://log.gprd.gitlab.net/app/kibana#/discover?_a=(columns:!(json.method,json.status,json.route,json.path,json.duration_s),filters:!((query:(match:(json.type.keyword:(query:api,type:phrase)))),(query:(match:(json.stage:(query:'$stage',type:phrase)))),(query:(match:(json.type:(query:api,type:phrase))))),index:'7092c4e2-4eb5-46f2-8305-a7da2edad090')\u0026_g=(time:(from:'${__from:date:iso}',to:'${__to:date:iso}')))\n* [üìñ Kibana: Rails slow request logs](https://log.gprd.gitlab.net/app/kibana#/discover?_a=(columns:!(json.method,json.status,json.route,json.path,json.duration_s),filters:!((query:(match:(json.type.keyword:(query:api,type:phrase)))),(query:(match:(json.stage:(query:'$stage',type:phrase)))),(query:(match:(json.type:(query:api,type:phrase)))),(query:(range:(json.duration_s:(gte:10))))),index:'7092c4e2-4eb5-46f2-8305-a7da2edad090',sort:!(!(json.duration_s,desc)))\u0026_g=(time:(from:'${__from:date:iso}',to:'${__to:date:iso}')))\n* [üìñ Kibana: Rails failed request logs](https://log.gprd.gitlab.net/app/kibana#/discover?_a=(columns:!(json.method,json.status,json.route,json.path,json.duration_s),filters:!((query:(match:(json.type.keyword:(query:api,type:phrase)))),(query:(match:(json.stage:(query:'$stage',type:phrase)))),(query:(match:(json.type:(query:api,type:phrase)))),(query:(range:(json.status:(gte:500))))),index:'7092c4e2-4eb5-46f2-8305-a7da2edad090')\u0026_g=(time:(from:'${__from:date:iso}',to:'${__to:date:iso}')))\n* [üìà Kibana: Rails requests](https://log.gprd.gitlab.net/app/kibana#/visualize/create?type=line\u0026indexPattern=7092c4e2-4eb5-46f2-8305-a7da2edad090\u0026_a=(filters:!((query:(match:(json.type.keyword:(query:api,type:phrase)))),(query:(match:(json.stage:(query:'$stage',type:phrase)))),(query:(match:(json.type:(query:api,type:phrase))))),query:(language:kuery,query:''),vis:(aggs:!((enabled:!t,id:'1',params:(),schema:metric,type:count),(enabled:!t,id:'2',params:(drop_partials:!t,extended_bounds:(),field:json.time,interval:auto,min_doc_count:1,scaleMetricValues:!f,timeRange:(from:'${__from:date:iso}',to:'${__to:date:iso}'),useNormalizedEsInterval:!t),schema:segment,type:date_histogram))))\u0026_g=(time:(from:'${__from:date:iso}',to:'${__to:date:iso}')))\n* [üìà Kibana: Rails failed requests](https://log.gprd.gitlab.net/app/kibana#/visualize/create?type=line\u0026indexPattern=7092c4e2-4eb5-46f2-8305-a7da2edad090\u0026_a=(filters:!((query:(match:(json.type.keyword:(query:api,type:phrase)))),(query:(match:(json.stage:(query:'$stage',type:phrase)))),(query:(match:(json.type:(query:api,type:phrase)))),(query:(range:(json.status:(gte:500))))),query:(language:kuery,query:''),vis:(aggs:!((enabled:!t,id:'1',params:(),schema:metric,type:count),(enabled:!t,id:'2',params:(drop_partials:!t,extended_bounds:(),field:json.time,interval:auto,min_doc_count:1,scaleMetricValues:!f,timeRange:(from:'${__from:date:iso}',to:'${__to:date:iso}'),useNormalizedEsInterval:!t),schema:segment,type:date_histogram))))\u0026_g=(time:(from:'${__from:date:iso}',to:'${__to:date:iso}')))\n* [üìà Kibana: Rails sum latency aggregated](https://log.gprd.gitlab.net/app/kibana#/visualize/create?type=line\u0026indexPattern=7092c4e2-4eb5-46f2-8305-a7da2edad090\u0026_a=(filters:!((query:(match:(json.type.keyword:(query:api,type:phrase)))),(query:(match:(json.stage:(query:'$stage',type:phrase)))),(query:(match:(json.type:(query:api,type:phrase))))),query:(language:kuery,query:''),vis:(aggs:!((enabled:!t,id:'1',params:(field:json.duration_s),schema:metric,type:sum),(enabled:!t,id:'2',params:(drop_partials:!t,extended_bounds:(),field:json.time,interval:auto,min_doc_count:1,scaleMetricValues:!f,timeRange:(from:'${__from:date:iso}',to:'${__to:date:iso}'),useNormalizedEsInterval:!t),schema:segment,type:date_histogram),(enabled:!t,id:'3',params:(field:json.route.keyword,missingBucket:!f,missingBucketLabel:Missing,order:desc,orderBy:'1',otherBucket:!t,otherBucketLabel:Other,size:5),schema:group,type:terms)),params:(valueAxes:!((id:'ValueAxis-1',name:'LeftAxis-1',position:left,scale:(mode:normal,type:linear),show:!t,style:(),title:(text:'Sum+Request+Duration:+json.duration_s'),type:value)))))\u0026_g=(time:(from:'${__from:date:iso}',to:'${__to:date:iso}')))\n* [üìà Kibana: Rails sum latency aggregated (split)](https://log.gprd.gitlab.net/app/kibana#/visualize/create?type=line\u0026indexPattern=7092c4e2-4eb5-46f2-8305-a7da2edad090\u0026_a=(filters:!((query:(match:(json.type.keyword:(query:api,type:phrase)))),(query:(match:(json.stage:(query:'$stage',type:phrase)))),(query:(match:(json.type:(query:api,type:phrase))))),query:(language:kuery,query:''),vis:(aggs:!((enabled:!t,id:'1',params:(field:json.duration_s),schema:metric,type:sum),(enabled:!t,id:'2',params:(drop_partials:!t,extended_bounds:(),field:json.time,interval:auto,min_doc_count:1,scaleMetricValues:!f,timeRange:(from:'${__from:date:iso}',to:'${__to:date:iso}'),useNormalizedEsInterval:!t),schema:segment,type:date_histogram),(enabled:!t,id:'3',params:(field:json.route.keyword,missingBucket:!f,missingBucketLabel:Missing,order:desc,orderBy:'1',otherBucket:!t,otherBucketLabel:Other,size:5),schema:group,type:terms)),params:(valueAxes:!((id:'ValueAxis-1',name:'LeftAxis-1',position:left,scale:(mode:normal,type:linear),show:!t,style:(),title:(text:'Sum+Request+Duration:+json.duration_s'),type:value)))))\u0026_g=(time:(from:'${__from:date:iso}',to:'${__to:date:iso}')))\n* [üìà Kibana: Rails percentile latency aggregated](https://log.gprd.gitlab.net/app/kibana#/visualize/create?type=line\u0026indexPattern=7092c4e2-4eb5-46f2-8305-a7da2edad090\u0026_a=(filters:!((query:(match:(json.type.keyword:(query:api,type:phrase)))),(query:(match:(json.stage:(query:'$stage',type:phrase)))),(query:(match:(json.type:(query:api,type:phrase))))),query:(language:kuery,query:''),vis:(aggs:!((enabled:!t,id:'1',params:(field:json.duration_s,percents:!(95)),schema:metric,type:percentiles),(enabled:!t,id:'2',params:(drop_partials:!t,extended_bounds:(),field:json.time,interval:auto,min_doc_count:1,scaleMetricValues:!f,timeRange:(from:'${__from:date:iso}',to:'${__to:date:iso}'),useNormalizedEsInterval:!t),schema:segment,type:date_histogram)),params:(valueAxes:!((id:'ValueAxis-1',name:'LeftAxis-1',position:left,scale:(mode:normal,type:linear),show:!t,style:(),title:(text:'p95+Request+Duration:+json.duration_s'),type:value)))))\u0026_g=(time:(from:'${__from:date:iso}',to:'${__to:date:iso}')))\n* [üìà Kibana: Rails percentile latency aggregated (split)](https://log.gprd.gitlab.net/app/kibana#/visualize/create?type=line\u0026indexPattern=7092c4e2-4eb5-46f2-8305-a7da2edad090\u0026_a=(filters:!((query:(match:(json.type.keyword:(query:api,type:phrase)))),(query:(match:(json.stage:(query:'$stage',type:phrase)))),(query:(match:(json.type:(query:api,type:phrase))))),query:(language:kuery,query:''),vis:(aggs:!((enabled:!t,id:'1',params:(field:json.duration_s,percents:!(95)),schema:metric,type:percentiles),(enabled:!t,id:'2',params:(drop_partials:!t,extended_bounds:(),field:json.time,interval:auto,min_doc_count:1,scaleMetricValues:!f,timeRange:(from:'${__from:date:iso}',to:'${__to:date:iso}'),useNormalizedEsInterval:!t),schema:segment,type:date_histogram),(enabled:!t,id:'3',params:(field:json.route.keyword,missingBucket:!f,missingBucketLabel:Missing,order:desc,orderAgg:(enabled:!t,id:'3-orderAgg',params:(field:json.duration_s),schema:orderAgg,type:sum),orderBy:custom,otherBucket:!t,otherBucketLabel:Other,size:5),schema:group,type:terms)),params:(valueAxes:!((id:'ValueAxis-1',name:'LeftAxis-1',position:left,scale:(mode:normal,type:linear),show:!t,style:(),title:(text:'p95+Request+Duration:+json.duration_s'),type:value)))))\u0026_g=(time:(from:'${__from:date:iso}',to:'${__to:date:iso}')))\n\n","gridPos":{"h":8,"w":6,"x":18,"y":1021},"id":15,"mode":"markdown","title":"Details","type":"text"},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Apdex is a measure of requests that complete within a tolerable period of time for the service. Higher is better.","fill":0,"gridPos":{"h":8,"w":6,"x":0,"y":1031},"id":2586818196,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"nullPointMode":"null","options":{"dataLinks":[{"targetBlank":true,"title":"workhorse SLI Apdex SLO Analysis","url":"/d/alerts-regional_component_slo_apdex?${__url_time_range}\u0026${__all_variables}\u0026var-component=workhorse\u0026var-type=api\u0026var-stage=$stage"}]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"6h Degradation SLO (5% of monthly error budget)","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"1h Outage SLO (2% of monthly error budget)","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"SLO","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2}],"spaceLength":10,"stableId":"sli-workhorse-apdex","stack":false,"steppedLine":false,"targets":[{"expr":"min_over_time(gitlab_regional_sli_apdex:ratio_5m{component=\"workhorse\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",stage=\"$stage\",type=\"api\"}[$__interval])\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ region }} apdex","refId":"A"},{"expr":"(1 - 6 * (1 - avg(slo:min:events:gitlab_service_apdex:ratio{monitor=\"global\",type=\"api\"})))\n","format":"time_series","interval":"5m","intervalFactor":3,"legendFormat":"6h Degradation SLO (5% of monthly error budget)","refId":"B"},{"expr":"(1 - 14.4 * (1 - avg(slo:min:events:gitlab_service_apdex:ratio{monitor=\"global\",type=\"api\"})))\n","format":"time_series","interval":"5m","intervalFactor":3,"legendFormat":"1h Outage SLO (2% of monthly error budget)","refId":"C"}],"title":"workhorse SLI Apdex","tooltip":{"shared":true,"sort":1,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"percentunit","label":"Apdex %","logBase":1,"max":1,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Error rates are a measure of unhandled service exceptions per second. Client errors are excluded when possible. Lower is better","fill":0,"gridPos":{"h":8,"w":6,"x":6,"y":1031},"id":2047984749,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"nullPointMode":"null","options":{"dataLinks":[{"targetBlank":true,"title":"workhorse SLI Error-Rate SLO Analysis","url":"/d/alerts-regional_component_slo_error?${__url_time_range}\u0026${__all_variables}\u0026var-component=workhorse\u0026var-type=api\u0026var-stage=$stage"}]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"6h Degradation SLO (5% of monthly error budget)","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"1h Outage SLO (2% of monthly error budget)","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2}],"spaceLength":10,"stableId":"sli-workhorse-error-rate","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_max(\n  max_over_time(gitlab_regional_sli_errors:ratio_5m{component=\"workhorse\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",stage=\"$stage\",type=\"api\"}[$__interval])\n,\n  1\n)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ region }} error ratio","refId":"A"},{"expr":"(6 * avg(slo:max:events:gitlab_service_errors:ratio{monitor=\"global\",type=\"api\"}))\n","format":"time_series","interval":"5m","intervalFactor":3,"legendFormat":"6h Degradation SLO (5% of monthly error budget)","refId":"B"},{"expr":"(14.4 * avg(slo:max:events:gitlab_service_errors:ratio{monitor=\"global\",type=\"api\"}))\n","format":"time_series","interval":"5m","intervalFactor":3,"legendFormat":"1h Outage SLO (2% of monthly error budget)","refId":"C"}],"title":"workhorse SLI Error Ratio","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"percentunit","label":"Error %","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"The operation rate is the sum total of all requests being handle for all components within this service. Note that a single user request can lead to requests to multiple components. Higher is busier.","fill":0,"gridPos":{"h":8,"w":6,"x":12,"y":1031},"id":831392945,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stableId":"sli-workhorse-ops-rate","stack":false,"steppedLine":false,"targets":[{"expr":"avg_over_time(gitlab_regional_sli_ops:rate_5m{component=\"workhorse\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",stage=\"$stage\",type=\"api\"}[$__interval])\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ region }} RPS","refId":"A"}],"title":"workhorse SLI RPS - Requests per Second","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Operations per Second","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"content":"### Description\n\nAggregation of most web requests that pass through workhorse, monitored via the HTTP interface.\nExcludes health, readiness and liveness requests. Some known slow requests, such as HTTP uploads,\nare excluded from the apdex score.\n\n\n\n### Observability Tools\n\n* [Google Stackdriver Continuous Profiling](https://console.cloud.google.com/profiler;timespan=4h/workhorse-api;type=CPU/cpu?project=gitlab-production)\n* [üêû Sentry Releases: gitlab/gitlab-workhorse-gitlabcom](https://sentry.gitlab.net/gitlab/gitlab-workhorse-gitlabcom/releases?environment=${environment})\n* [üêû Sentry issues](https://sentry.gitlab.net/gitlab/gitlab-workhorse-gitlabcom/issues?environment=${environment})\n* [üìñ Kibana: Workhorse logs](https://log.gprd.gitlab.net/app/kibana#/discover?_a=(columns:!(json.method,json.remote_ip,json.status,json.uri,json.duration_ms),filters:!((query:(match:(json.type.keyword:(query:api,type:phrase)))),(query:(match:(json.stage:(query:'$stage',type:phrase)))),(query:(match:(json.type:(query:api,type:phrase))))),index:'a4f5b470-edde-11ea-81e5-155ba78758d4')\u0026_g=(time:(from:'${__from:date:iso}',to:'${__to:date:iso}')))\n* [üìñ Kibana: Workhorse slow request logs](https://log.gprd.gitlab.net/app/kibana#/discover?_a=(columns:!(json.method,json.remote_ip,json.status,json.uri,json.duration_ms),filters:!((query:(match:(json.type.keyword:(query:api,type:phrase)))),(query:(match:(json.stage:(query:'$stage',type:phrase)))),(query:(match:(json.type:(query:api,type:phrase)))),(query:(range:(json.duration_ms:(gte:10000))))),index:'a4f5b470-edde-11ea-81e5-155ba78758d4',sort:!(!(json.duration_ms,desc)))\u0026_g=(time:(from:'${__from:date:iso}',to:'${__to:date:iso}')))\n* [üìñ Kibana: Workhorse failed request logs](https://log.gprd.gitlab.net/app/kibana#/discover?_a=(columns:!(json.method,json.remote_ip,json.status,json.uri,json.duration_ms),filters:!((query:(match:(json.type.keyword:(query:api,type:phrase)))),(query:(match:(json.stage:(query:'$stage',type:phrase)))),(query:(match:(json.type:(query:api,type:phrase)))),(query:(range:(json.status:(gte:500))))),index:'a4f5b470-edde-11ea-81e5-155ba78758d4')\u0026_g=(time:(from:'${__from:date:iso}',to:'${__to:date:iso}')))\n* [üìà Kibana: Workhorse requests](https://log.gprd.gitlab.net/app/kibana#/visualize/create?type=line\u0026indexPattern=a4f5b470-edde-11ea-81e5-155ba78758d4\u0026_a=(filters:!((query:(match:(json.type.keyword:(query:api,type:phrase)))),(query:(match:(json.stage:(query:'$stage',type:phrase)))),(query:(match:(json.type:(query:api,type:phrase))))),query:(language:kuery,query:''),vis:(aggs:!((enabled:!t,id:'1',params:(),schema:metric,type:count),(enabled:!t,id:'2',params:(drop_partials:!t,extended_bounds:(),field:json.time,interval:auto,min_doc_count:1,scaleMetricValues:!f,timeRange:(from:'${__from:date:iso}',to:'${__to:date:iso}'),useNormalizedEsInterval:!t),schema:segment,type:date_histogram))))\u0026_g=(time:(from:'${__from:date:iso}',to:'${__to:date:iso}')))\n* [üìà Kibana: Workhorse failed requests](https://log.gprd.gitlab.net/app/kibana#/visualize/create?type=line\u0026indexPattern=a4f5b470-edde-11ea-81e5-155ba78758d4\u0026_a=(filters:!((query:(match:(json.type.keyword:(query:api,type:phrase)))),(query:(match:(json.stage:(query:'$stage',type:phrase)))),(query:(match:(json.type:(query:api,type:phrase)))),(query:(range:(json.status:(gte:500))))),query:(language:kuery,query:''),vis:(aggs:!((enabled:!t,id:'1',params:(),schema:metric,type:count),(enabled:!t,id:'2',params:(drop_partials:!t,extended_bounds:(),field:json.time,interval:auto,min_doc_count:1,scaleMetricValues:!f,timeRange:(from:'${__from:date:iso}',to:'${__to:date:iso}'),useNormalizedEsInterval:!t),schema:segment,type:date_histogram))))\u0026_g=(time:(from:'${__from:date:iso}',to:'${__to:date:iso}')))\n* [üìà Kibana: Workhorse sum latency aggregated](https://log.gprd.gitlab.net/app/kibana#/visualize/create?type=line\u0026indexPattern=a4f5b470-edde-11ea-81e5-155ba78758d4\u0026_a=(filters:!((query:(match:(json.type.keyword:(query:api,type:phrase)))),(query:(match:(json.stage:(query:'$stage',type:phrase)))),(query:(match:(json.type:(query:api,type:phrase))))),query:(language:kuery,query:''),vis:(aggs:!((enabled:!t,id:'1',params:(field:json.duration_ms),schema:metric,type:sum),(enabled:!t,id:'2',params:(drop_partials:!t,extended_bounds:(),field:json.time,interval:auto,min_doc_count:1,scaleMetricValues:!f,timeRange:(from:'${__from:date:iso}',to:'${__to:date:iso}'),useNormalizedEsInterval:!t),schema:segment,type:date_histogram),(enabled:!t,id:'3',params:(field:json.remote_ip.keyword,missingBucket:!f,missingBucketLabel:Missing,order:desc,orderBy:'1',otherBucket:!t,otherBucketLabel:Other,size:5),schema:group,type:terms)),params:(valueAxes:!((id:'ValueAxis-1',name:'LeftAxis-1',position:left,scale:(mode:normal,type:linear),show:!t,style:(),title:(text:'Sum+Request+Duration:+json.duration_ms'),type:value)))))\u0026_g=(time:(from:'${__from:date:iso}',to:'${__to:date:iso}')))\n* [üìà Kibana: Workhorse sum latency aggregated (split)](https://log.gprd.gitlab.net/app/kibana#/visualize/create?type=line\u0026indexPattern=a4f5b470-edde-11ea-81e5-155ba78758d4\u0026_a=(filters:!((query:(match:(json.type.keyword:(query:api,type:phrase)))),(query:(match:(json.stage:(query:'$stage',type:phrase)))),(query:(match:(json.type:(query:api,type:phrase))))),query:(language:kuery,query:''),vis:(aggs:!((enabled:!t,id:'1',params:(field:json.duration_ms),schema:metric,type:sum),(enabled:!t,id:'2',params:(drop_partials:!t,extended_bounds:(),field:json.time,interval:auto,min_doc_count:1,scaleMetricValues:!f,timeRange:(from:'${__from:date:iso}',to:'${__to:date:iso}'),useNormalizedEsInterval:!t),schema:segment,type:date_histogram),(enabled:!t,id:'3',params:(field:json.remote_ip.keyword,missingBucket:!f,missingBucketLabel:Missing,order:desc,orderBy:'1',otherBucket:!t,otherBucketLabel:Other,size:5),schema:group,type:terms)),params:(valueAxes:!((id:'ValueAxis-1',name:'LeftAxis-1',position:left,scale:(mode:normal,type:linear),show:!t,style:(),title:(text:'Sum+Request+Duration:+json.duration_ms'),type:value)))))\u0026_g=(time:(from:'${__from:date:iso}',to:'${__to:date:iso}')))\n* [üìà Kibana: Workhorse percentile latency aggregated](https://log.gprd.gitlab.net/app/kibana#/visualize/create?type=line\u0026indexPattern=a4f5b470-edde-11ea-81e5-155ba78758d4\u0026_a=(filters:!((query:(match:(json.type.keyword:(query:api,type:phrase)))),(query:(match:(json.stage:(query:'$stage',type:phrase)))),(query:(match:(json.type:(query:api,type:phrase))))),query:(language:kuery,query:''),vis:(aggs:!((enabled:!t,id:'1',params:(field:json.duration_ms,percents:!(95)),schema:metric,type:percentiles),(enabled:!t,id:'2',params:(drop_partials:!t,extended_bounds:(),field:json.time,interval:auto,min_doc_count:1,scaleMetricValues:!f,timeRange:(from:'${__from:date:iso}',to:'${__to:date:iso}'),useNormalizedEsInterval:!t),schema:segment,type:date_histogram)),params:(valueAxes:!((id:'ValueAxis-1',name:'LeftAxis-1',position:left,scale:(mode:normal,type:linear),show:!t,style:(),title:(text:'p95+Request+Duration:+json.duration_ms'),type:value)))))\u0026_g=(time:(from:'${__from:date:iso}',to:'${__to:date:iso}')))\n* [üìà Kibana: Workhorse percentile latency aggregated (split)](https://log.gprd.gitlab.net/app/kibana#/visualize/create?type=line\u0026indexPattern=a4f5b470-edde-11ea-81e5-155ba78758d4\u0026_a=(filters:!((query:(match:(json.type.keyword:(query:api,type:phrase)))),(query:(match:(json.stage:(query:'$stage',type:phrase)))),(query:(match:(json.type:(query:api,type:phrase))))),query:(language:kuery,query:''),vis:(aggs:!((enabled:!t,id:'1',params:(field:json.duration_ms,percents:!(95)),schema:metric,type:percentiles),(enabled:!t,id:'2',params:(drop_partials:!t,extended_bounds:(),field:json.time,interval:auto,min_doc_count:1,scaleMetricValues:!f,timeRange:(from:'${__from:date:iso}',to:'${__to:date:iso}'),useNormalizedEsInterval:!t),schema:segment,type:date_histogram),(enabled:!t,id:'3',params:(field:json.remote_ip.keyword,missingBucket:!f,missingBucketLabel:Missing,order:desc,orderAgg:(enabled:!t,id:'3-orderAgg',params:(field:json.duration_ms),schema:orderAgg,type:sum),orderBy:custom,otherBucket:!t,otherBucketLabel:Other,size:5),schema:group,type:terms)),params:(valueAxes:!((id:'ValueAxis-1',name:'LeftAxis-1',position:left,scale:(mode:normal,type:linear),show:!t,style:(),title:(text:'p95+Request+Duration:+json.duration_ms'),type:value)))))\u0026_g=(time:(from:'${__from:date:iso}',to:'${__to:date:iso}')))\n\n","gridPos":{"h":8,"w":6,"x":18,"y":1031},"id":19,"mode":"markdown","title":"Details","type":"text"},{"content":"Made with ‚ù§Ô∏è and [Grafonnet](https://github.com/grafana/grafonnet-lib). [Contribute to this dashboard on GitLab.com](https://gitlab.com/gitlab-com/runbooks/blob/master/dashboards)\n","datasource":null,"gridPos":{"h":2,"w":24,"x":0,"y":110000},"id":20,"mode":"markdown","title":"Source","type":"text"}],"refresh":"","rows":[],"schemaVersion":16,"style":"light","tags":["managed","api","type:api","regional"],"templating":{"list":[{"current":{"text":"Global","value":"Global"},"hide":0,"label":null,"name":"PROMETHEUS_DS","options":[],"query":"prometheus","refresh":1,"regex":"","type":"datasource"},{"allValue":null,"current":{"text":"gprd","value":"gprd"},"datasource":"$PROMETHEUS_DS","hide":0,"includeAll":false,"label":null,"multi":false,"name":"environment","options":[],"query":"label_values(gitlab_service_ops:rate, environment)","refresh":1,"regex":"","sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":null,"current":{"text":"main","value":"main"},"hide":0,"includeAll":false,"label":"","multi":false,"name":"stage","options":[{"text":"main","value":"main"},{"text":"cny","value":"cny"},{"text":"","value":""}],"query":"main,cny,","refresh":0,"type":"custom"}]},"time":{"from":"now-6h/m","to":"now/m"},"timepicker":{"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"utc","title":"api: Regional Detail","uid":"api-regional","version":610}}