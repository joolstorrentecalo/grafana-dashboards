{
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": {
          "type": "grafana",
          "uid": "-- Grafana --"
        },
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "description": "This dashboard gives an overview of the components the Pre-receive SD feature interacts and monitors their stability and performance.",
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 0,
  "id": null,
  "links": [

  ],
  "liveNow": true,
  "panels": [
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PA258B30F88C30650"
      },
      "description": "",
      "gridPos": {
        "h": 3,
        "w": 24,
        "x": 0,
        "y": 0
      },
      "id": 8,
      "options": {
        "code": {
          "language": "plaintext",
          "showLineNumbers": false,
          "showMiniMap": false
        },
        "content": "# Pre-receive Secret Detection ‚Äì Overview\n\nPlease read the associated [runbook](https://handbook.gitlab.com/handbook/engineering/development/sec/secure/secret-detection/runbooks/pre-receive-secret-detection-monitoring/) for more information on how to read and update this dashboard.",
        "mode": "markdown"
      },
      "pluginVersion": "10.4.2",
      "type": "text"
    },
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 3
      },
      "id": 14,
      "panels": [

      ],
      "title": "üêö GitLab Shell (Git over SSH)",
      "type": "row"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PA258B30F88C30650"
      },
      "description": "This panel displays average number of requests per second (RPS) made to `gitlab-shell` over time. The panel can be used to monitor request rates and understand if there's a performance or scalability issue. Use the link for more detailed overview of this metric. Note: this isn't specific to `git-receive-pack` command.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineStyle": {
              "fill": "solid"
            },
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": true,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [

          ],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "short"
        },
        "overrides": [
          {
            "__systemRef": "hideSeriesFrom",
            "matcher": {
              "id": "byNames",
              "options": {
                "mode": "exclude",
                "names": [
                  "RPS"
                ],
                "prefix": "All except:",
                "readOnly": true
              }
            },
            "properties": [
              {
                "id": "custom.hideFrom",
                "value": {
                  "legend": false,
                  "tooltip": false,
                  "viz": true
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 4
      },
      "id": 17,
      "links": [
        {
          "targetBlank": true,
          "title": "gitlab-shell / RPS (Requests Per Second) Details",
          "url": "https://dashboards.gitlab.net/d/git-main/git3a-overview?orgId=1&viewPanel=424944884"
        }
      ],
      "options": {
        "legend": {
          "calcs": [

          ],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "mode": "single",
          "sort": "none"
        }
      },
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "PA258B30F88C30650"
          },
          "disableTextWrap": false,
          "editorMode": "builder",
          "expr": "avg_over_time(gitlab_component_ops:rate_5m{component=\"gitlab_shell\", env=\"gprd\", monitor=\"global\", stage=\"main\", type=\"git\"}[$__interval])",
          "fullMetaSearch": false,
          "includeNullMetadata": true,
          "instant": false,
          "interval": "5",
          "legendFormat": "RPS",
          "range": true,
          "refId": "RPS",
          "useBackend": false
        }
      ],
      "title": "gitlab‚Äìshell / RPS (Requests Per Second)",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PA258B30F88C30650"
      },
      "description": "",
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 4
      },
      "id": 18,
      "options": {
        "code": {
          "language": "plaintext",
          "showLineNumbers": false,
          "showMiniMap": false
        },
        "content": "#### Description\n\nThis sub-section monitors [`gitlab-shell` tool](https://gitlab.com/gitlab-org/gitlab-shell) which is a set of executables used to handle git push over SSH (among other things). Most of the metrics available for `gitlab-shell` though aren't aggregated by the command used, so it does make sense to look more closely at the Kibana logs linked below for a good measure of how the `git-receive-pack` command is performing.\n\n#### Observability Tools\n\n* üìñ [Kibana: GitLab Shell Logs ‚Äì For `git-receive-pack` command](https://log.gprd.gitlab.net/app/discover#/view/d7431f7a-95a1-4981-910f-6ffa575aa8f2?_g=()).\n* üìñ [Kibana: GitLab Shell Failed Requests Logs](https://log.gprd.gitlab.net/app/discover#/view/23da9f7a-1cf0-4fb1-9917-6f2596920539?_g=()).\n\n**Note**: `json.command` for failed requests isn't populated, so link above displays all failed requests.",
        "mode": "markdown"
      },
      "pluginVersion": "10.4.2",
      "title": "Details",
      "type": "text"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PA258B30F88C30650"
      },
      "description": "This panel displays the total number of Gitaly connections that have been established by `gitlab-shell` at a given time. This panel can be used to determine if there's a sudden drop in connections between both components, which may indicate a performance or an availability issue. Note: this isn't specific to `git-receive-pack` command.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 10,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [

          ],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": [

        ]
      },
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 12
      },
      "id": 15,
      "options": {
        "legend": {
          "calcs": [

          ],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "mode": "single",
          "sort": "none"
        }
      },
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "PA258B30F88C30650"
          },
          "disableTextWrap": false,
          "editorMode": "builder",
          "expr": "count by(status) (gitlab_shell_gitaly_connections_total{env=\"gprd\", stage=\"main\"})",
          "fullMetaSearch": false,
          "includeNullMetadata": false,
          "instant": false,
          "legendFormat": "__auto",
          "range": true,
          "refId": "A",
          "useBackend": false
        }
      ],
      "title": "gitlab-shell / Total Established Gitaly Connections",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PA258B30F88C30650"
      },
      "description": "This panel displays the minimum number of established SSH sessions at a given time. The panel can be used to understand if there's an availability issue together with the panel adjacent to it which shows how the maximum number of SSH sessions that failed to establish at a given time. Note: this isn't specific to `git-receive-pack` command.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [

          ],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          }
        },
        "overrides": [

        ]
      },
      "gridPos": {
        "h": 8,
        "w": 6,
        "x": 0,
        "y": 20
      },
      "id": 22,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "showPercentChange": false,
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "10.4.2",
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "PA258B30F88C30650"
          },
          "disableTextWrap": false,
          "editorMode": "builder",
          "expr": "min(gitlab_sli:shell_sshd_sessions:total{env=\"gprd\", stage=\"main\", type=\"git\"})",
          "fullMetaSearch": false,
          "includeNullMetadata": false,
          "instant": false,
          "legendFormat": "__auto",
          "range": true,
          "refId": "A",
          "useBackend": false
        }
      ],
      "title": "gitlab-shell / Established SSH Sessions",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PA258B30F88C30650"
      },
      "description": "This panel displays the maximum number of failed SSH sessions at a given time. The panel can be used to understand if there's an availability issues together with the panel adjacent to it which shows how the minimum number of SSH sessions established over a given time. Note: this isn't specific to `git-receive-pack` command.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [

          ],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 10
              }
            ]
          }
        },
        "overrides": [

        ]
      },
      "gridPos": {
        "h": 8,
        "w": 6,
        "x": 6,
        "y": 20
      },
      "id": 19,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "showPercentChange": false,
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "10.4.2",
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "PA258B30F88C30650"
          },
          "disableTextWrap": false,
          "editorMode": "builder",
          "expr": "max by(app) (gitlab_sli:shell_sshd_sessions:errors_total{stage=\"main\", type=\"git\", env=\"gprd\"})",
          "fullMetaSearch": false,
          "includeNullMetadata": false,
          "instant": false,
          "legendFormat": "__auto",
          "range": true,
          "refId": "A",
          "useBackend": false
        }
      ],
      "title": "gitlab-shell / Failed SSH Sessions",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PA258B30F88C30650"
      },
      "description": "This panel displays the average duration of establish SSH sessions summed up over a range of 24 hours. The panel can be used to determine if there's an increase in the duration of a git pull/push over SSH which may indicate a performance or availability issue. Note: this isn't specific to `git-receive-pack` command.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 10,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [

          ],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "s"
        },
        "overrides": [

        ]
      },
      "gridPos": {
        "h": 8,
        "w": 6,
        "x": 12,
        "y": 20
      },
      "id": 27,
      "options": {
        "legend": {
          "calcs": [

          ],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "mode": "single",
          "sort": "none"
        }
      },
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "PA258B30F88C30650"
          },
          "disableTextWrap": false,
          "editorMode": "builder",
          "expr": "sum(rate(gitlab_shell_sshd_session_established_duration_seconds_sum{env=\"gprd\", stage=\"main\", type=\"git\"}[24h])) / sum(rate(gitlab_shell_sshd_session_established_duration_seconds_count[24h]))",
          "fullMetaSearch": false,
          "includeNullMetadata": false,
          "instant": false,
          "legendFormat": "{{label_name}}",
          "range": true,
          "refId": "A",
          "useBackend": false
        }
      ],
      "title": "gitlab-shell / Established Session Average Duration",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PA258B30F88C30650"
      },
      "description": "This panel displays the average duration of all SSH sessions (whether established or failed) summed up over a range of 24 hours. The panel can be used to determine if there's an increase in the duration of a git pull/push over SSH which may indicate a performance or availability issue. Note: this isn't specific to `git-receive-pack` command.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 10,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [

          ],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "s"
        },
        "overrides": [

        ]
      },
      "gridPos": {
        "h": 8,
        "w": 6,
        "x": 18,
        "y": 20
      },
      "id": 20,
      "options": {
        "legend": {
          "calcs": [

          ],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "mode": "single",
          "sort": "none"
        }
      },
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "PA258B30F88C30650"
          },
          "disableTextWrap": false,
          "editorMode": "code",
          "expr": "sum(rate(gitlab_shell_sshd_session_duration_seconds_sum{env=\"gprd\", stage=\"main\", type=\"git\"}[24h])) / sum(rate(gitlab_shell_sshd_session_duration_seconds_count[24h]))",
          "fullMetaSearch": false,
          "includeNullMetadata": false,
          "instant": false,
          "legendFormat": "{{label_name}}",
          "range": true,
          "refId": "A",
          "useBackend": false
        }
      ],
      "title": "gitlab-shell / All Sessions Average Duration",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PA258B30F88C30650"
      },
      "description": "This panel displays the application performance index (Apdex) for the `gitlab-sshd` SSH daemon/server. This Service Level Indicator (SLI) averages close to 99.9%, most of the time but a drop in the indicator could point to an outage or degradation. Use the link for more detailed overview of this metric. Note: this isn't specific to git-receive-pack command.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "Apdex %",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineStyle": {
              "fill": "solid"
            },
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": true,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "fieldMinMax": false,
          "mappings": [

          ],
          "max": 1,
          "thresholds": {
            "mode": "percentage",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 99
              }
            ]
          },
          "unit": "percentunit"
        },
        "overrides": [

        ]
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 28
      },
      "id": 24,
      "links": [
        {
          "targetBlank": true,
          "title": "gitlab-sshd / SLI Apdex Details",
          "url": "https://dashboards.gitlab.net/d/git-main/git3a-overview?orgId=1&viewPanel=2395479737"
        }
      ],
      "options": {
        "legend": {
          "calcs": [

          ],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "mode": "single",
          "sort": "none"
        }
      },
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "PA258B30F88C30650"
          },
          "disableTextWrap": false,
          "editorMode": "builder",
          "expr": "min_over_time(gitlab_component_apdex:ratio_5m{component=\"gitlab_sshd\",env=\"gprd\",environment=\"gprd\",monitor=\"global\",stage=\"main\",type=\"git\"}[$__interval])",
          "fullMetaSearch": false,
          "includeNullMetadata": true,
          "instant": false,
          "legendFormat": "Apdex",
          "range": true,
          "refId": "RPS",
          "useBackend": false
        }
      ],
      "title": "gitlab-sshd / SLI Apdex",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PA258B30F88C30650"
      },
      "description": "",
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 28
      },
      "id": 23,
      "options": {
        "code": {
          "language": "plaintext",
          "showLineNumbers": false,
          "showMiniMap": false
        },
        "content": "#### Description\n\nThis sub-section monitors the [`gitlab-sshd` daemon](https://docs.gitlab.com/ee/development/gitlab_shell/gitlab_sshd.html), which is the SSH server `gitlab-shell` uses to communicate with Rails to perform authorization or access checks. Most metrics available for `gitlab-sshd` aren't aggregated by the command used though, so take them with a grain of salt and focus more on the Kibana links below to learn how `git-receive-pack` is performing.\n\n#### Observability Tools\n\n* üìñ [Kibana: GitLab Shell Logs ‚Äì For `git-receive-pack` command](https://log.gprd.gitlab.net/app/discover#/view/d7431f7a-95a1-4981-910f-6ffa575aa8f2?_g=()).\n* üìñ [Kibana: GitLab Shell Failed Requests Logs](https://log.gprd.gitlab.net/app/discover#/view/23da9f7a-1cf0-4fb1-9917-6f2596920539?_g=()).\n\n**Note**: `json.command` for failed requests isn't populated, so link above displays all failed requests.",
        "mode": "markdown"
      },
      "pluginVersion": "10.4.2",
      "title": "Details",
      "type": "text"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PA258B30F88C30650"
      },
      "description": "This panel displays the max ratio of errors clamped to maximum value received for the `gitlab-sshd` SSH daemon/server. This Service Level Indicator (SLI) averages close to 0.01%, most of the time but an increase in the indicator could point to an outage or degradation. Use the link for more detailed overview of this metric. Note: this isn't specific to git-receive-pack command.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineStyle": {
              "fill": "solid"
            },
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": true,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "displayName": "Error %",
          "mappings": [

          ],
          "min": 0,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "percentunit"
        },
        "overrides": [

        ]
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 36
      },
      "id": 25,
      "links": [
        {
          "targetBlank": true,
          "title": "gitlab-sshd / SLI Error Ratio",
          "url": "https://dashboards.gitlab.net/d/git-main/git3a-overview?orgId=1&viewPanel=2213856730"
        }
      ],
      "options": {
        "legend": {
          "calcs": [

          ],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "mode": "single",
          "sort": "none"
        }
      },
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "PA258B30F88C30650"
          },
          "disableTextWrap": false,
          "editorMode": "builder",
          "expr": "clamp_max(max_over_time(gitlab_component_errors:ratio_5m{component=\"gitlab_sshd\",env=\"gprd\",environment=\"gprd\",monitor=\"global\",stage=\"main\",type=\"git\"}[$__interval]), 1)",
          "fullMetaSearch": false,
          "includeNullMetadata": true,
          "instant": false,
          "legendFormat": "Error Ratio",
          "range": true,
          "refId": "RPS",
          "useBackend": false
        }
      ],
      "title": "gitlab‚Äìsshd / SLI Error Ratio Details",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PA258B30F88C30650"
      },
      "description": "This panel displays average number of requests per second (RPS) made to `gitlab-sshd` SSH daemon/server over time. The panel can be used to monitor request rates and understand if there's a performance or scalability issue. Use the link for more detailed overview of this metric. Note: this isn't specific to `git-receive-pack` command.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineStyle": {
              "fill": "solid"
            },
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": true,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [

          ],
          "min": 0,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "short"
        },
        "overrides": [
          {
            "__systemRef": "hideSeriesFrom",
            "matcher": {
              "id": "byNames",
              "options": {
                "mode": "exclude",
                "names": [
                  "RPS"
                ],
                "prefix": "All except:",
                "readOnly": true
              }
            },
            "properties": [
              {
                "id": "custom.hideFrom",
                "value": {
                  "legend": false,
                  "tooltip": false,
                  "viz": true
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 36
      },
      "id": 26,
      "links": [
        {
          "targetBlank": true,
          "title": "gitlab-sshd / RPS (Requests Per Seconds) Details",
          "url": "https://dashboards.gitlab.net/d/git-main/git3a-overview?orgId=1&viewPanel=315783164"
        }
      ],
      "options": {
        "legend": {
          "calcs": [

          ],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "mode": "single",
          "sort": "none"
        }
      },
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "PA258B30F88C30650"
          },
          "disableTextWrap": false,
          "editorMode": "code",
          "expr": "avg_over_time(gitlab_component_ops:rate_5m{component=\"gitlab_sshd\",env=\"gprd\",environment=\"gprd\",monitor=\"global\",stage=\"main\",type=\"git\"}[$__interval])",
          "fullMetaSearch": false,
          "includeNullMetadata": true,
          "instant": false,
          "legendFormat": "RPS",
          "range": true,
          "refId": "RPS",
          "useBackend": false
        }
      ],
      "title": "gitlab‚Äìsshd / RPS (Requests Per Second)",
      "type": "timeseries"
    },
    {
      "collapsed": true,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 44
      },
      "id": 3,
      "panels": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "PA258B30F88C30650"
          },
          "description": "This panel displays the number of HTTP requests that have been processed by `workhorse` over time since last restart of the service, increasing in range of 24 hours. The panel partitions these requests by the HTTP verb/method and response code. This panel can be used to determine if the amount of `git-receive-pack` requests with a response code that isn't `200` had increased recently, indicating an issue with processing such requests.",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "smooth",
                "lineStyle": {
                  "fill": "solid"
                },
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "never",
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [

              ],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": null
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "none"
            },
            "overrides": [

            ]
          },
          "gridPos": {
            "h": 7,
            "w": 12,
            "x": 0,
            "y": 5
          },
          "id": 2,
          "options": {
            "legend": {
              "calcs": [

              ],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "mode": "single",
              "sort": "none"
            }
          },
          "targets": [
            {
              "datasource": {
                "type": "prometheus",
                "uid": "PA258B30F88C30650"
              },
              "disableTextWrap": false,
              "editorMode": "builder",
              "exemplar": false,
              "expr": "sum by(code, method) (increase(gitlab_workhorse_git_http_requests{exported_service=\"git-receive-pack\", stage=\"main\", env=\"gprd\", code!=\"0\"}[24h]))",
              "fullMetaSearch": false,
              "includeNullMetadata": false,
              "instant": false,
              "interval": "1h",
              "legendFormat": "{{code}} | {{method}}",
              "range": true,
              "refId": "A",
              "useBackend": false
            }
          ],
          "title": "Processed `git-receive-pack` Requests",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "PA258B30F88C30650"
          },
          "description": "",
          "gridPos": {
            "h": 7,
            "w": 12,
            "x": 12,
            "y": 5
          },
          "id": 28,
          "options": {
            "code": {
              "language": "plaintext",
              "showLineNumbers": false,
              "showMiniMap": false
            },
            "content": "## Description\n\n## Observability Tools\n\n",
            "mode": "markdown"
          },
          "pluginVersion": "10.4.2",
          "title": "Details",
          "type": "text"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "PA258B30F88C30650"
          },
          "description": "This panel displays the total number of `Gitaly` connections that have been established by `workhorse` at a given time. This panel can be used to determine if there's a sudden drop in connections between both components, which may indicate a performance or an availability issue.",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "drawStyle": "line",
                "fillOpacity": 10,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [

              ],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": null
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": [

            ]
          },
          "gridPos": {
            "h": 7,
            "w": 24,
            "x": 0,
            "y": 12
          },
          "id": 6,
          "options": {
            "legend": {
              "calcs": [

              ],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "10.4.2",
          "targets": [
            {
              "datasource": {
                "type": "prometheus",
                "uid": "PA258B30F88C30650"
              },
              "disableTextWrap": false,
              "editorMode": "builder",
              "exemplar": false,
              "expr": "count by(status) (gitlab_workhorse_gitaly_connections_total{env=\"gprd\", stage=\"main\"})",
              "format": "time_series",
              "fullMetaSearch": false,
              "includeNullMetadata": true,
              "instant": false,
              "interval": "",
              "legendFormat": "{{status}}",
              "range": true,
              "refId": "A",
              "useBackend": false
            }
          ],
          "title": "Total Established Gitaly Connections",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "PA258B30F88C30650"
          },
          "description": "This panel displays the average latency (duration) in seconds for the `/.git/git-receive-pack` request for all nodes running `workhorse`. This panel can be used to determine if there is an increase in response times for that specific request, which could indicate performance degradation issue if it surpassed a certain thershold.",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "drawStyle": "line",
                "fillOpacity": 10,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineStyle": {
                  "fill": "solid"
                },
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [

              ],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": null
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "s"
            },
            "overrides": [

            ]
          },
          "gridPos": {
            "h": 7,
            "w": 24,
            "x": 0,
            "y": 19
          },
          "id": 7,
          "options": {
            "legend": {
              "calcs": [

              ],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "mode": "single",
              "sort": "none"
            }
          },
          "targets": [
            {
              "datasource": {
                "type": "prometheus",
                "uid": "PA258B30F88C30650"
              },
              "disableTextWrap": false,
              "editorMode": "builder",
              "expr": "sum(rate(gitlab_workhorse_http_request_duration_seconds_sum{env=\"gprd\", stage=\"main\", route=\"^/.+\\\\.git/git-receive-pack\\\\z\"}[24h])) / sum(rate(gitlab_workhorse_http_request_duration_seconds_count{env=\"gprd\", stage=\"main\", route=\"^/.+\\\\.git/git-receive-pack\\\\z\"}[24h]))",
              "fullMetaSearch": false,
              "includeNullMetadata": false,
              "instant": false,
              "interval": "",
              "legendFormat": "{{label_name}}",
              "range": true,
              "refId": "A",
              "useBackend": false
            }
          ],
          "title": "Average Latency for `/.git/git-receive-pack` Request [All Nodes]",
          "type": "timeseries"
        }
      ],
      "title": "üêé Workhorse (Git over HTTP/S)",
      "type": "row"
    },
    {
      "collapsed": true,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 45
      },
      "id": 4,
      "panels": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "PA5EEDCB71676F488"
          },
          "description": "",
          "gridPos": {
            "h": 7,
            "w": 6,
            "x": 0,
            "y": 6
          },
          "id": 12,
          "options": {
            "code": {
              "language": "plaintext",
              "showLineNumbers": false,
              "showMiniMap": false
            },
            "content": "#### During `/internal/allowed` Endpoint ‚Äì Loading Blobs\n\n\nTODO: Explain how these RPCs are while checking secrets from the `/internal/allowed` endpoint to load blobs of a certain `git` push operation.",
            "mode": "markdown"
          },
          "pluginVersion": "10.4.2",
          "type": "text"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "PA5EEDCB71676F488"
          },
          "description": "This panel displays the average latency in milliseconds for all calls to the `ListAllBlobs` RPC, which is responsible (within the context of the feature) for enumerating all blobs of a repository under a certain size limit (i.e. exactly 1MiB). This procedure is usually fast because it is mostly used with the size limit set to `0` for checking file sizes of blobs in a certain `git` push.",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "decimals": 0,
              "mappings": [
                {
                  "options": {
                    "null": {
                      "index": 0,
                      "text": "N/A"
                    }
                  },
                  "type": "value"
                }
              ],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": null
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "ms"
            },
            "overrides": [

            ]
          },
          "gridPos": {
            "h": 7,
            "w": 9,
            "x": 6,
            "y": 6
          },
          "id": 10,
          "links": [
            {
              "targetBlank": true,
              "title": "ListAllBlobs ‚Äì Latency Detail",
              "url": "https://dashboards.gitlab.net/d/PqeIQ9Iik/gitaly-feature-latency-detail?from=now-24h&orgId=1&refresh=5m&to=now&var-job=gitaly&var-method=ListAllBlobs"
            }
          ],
          "options": {
            "colorMode": "background",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "horizontal",
            "reduceOptions": {
              "calcs": [
                "mean"
              ],
              "fields": "/^Value$/",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "10.4.2",
          "targets": [
            {
              "datasource": {
                "type": "prometheus",
                "uid": "PA5EEDCB71676F488"
              },
              "dsType": "influxdb",
              "editorMode": "code",
              "exemplar": false,
              "expr": "avg(1000 * avg(gitaly:grpc_server_handling_seconds:avg5m{job=\"gitaly\", grpc_method=\"ListAllBlobs\"}))\n",
              "format": "time_series",
              "groupBy": [
                {
                  "params": [
                    "$__interval"
                  ],
                  "type": "time"
                },
                {
                  "params": [
                    "null"
                  ],
                  "type": "fill"
                }
              ],
              "instant": false,
              "interval": "",
              "intervalFactor": 2,
              "legendFormat": "{{ method }}",
              "orderByTime": "ASC",
              "policy": "default",
              "range": true,
              "refId": "A",
              "resultFormat": "time_series",
              "select": [
                [
                  {
                    "params": [
                      "value"
                    ],
                    "type": "field"
                  },
                  {
                    "params": [

                    ],
                    "type": "mean"
                  }
                ]
              ],
              "step": 3600,
              "tags": [

              ]
            }
          ],
          "title": "ListAllBlobs ‚Äì Average Latency [All Hosts]",
          "type": "stat"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "PA5EEDCB71676F488"
          },
          "description": "This panel displays the average latency in milliseconds for all calls to the `ListBlobs` RPC, which is responsible (within the context of the feature) for enumerating all blobs of a repository under a certain size limit (i.e. exactly 1MiB), similar to `ListAllBlobs`, but it also loads up file paths for those blobs. The procedure is often slower than `ListAllBlobs` because it loads up blob contents when enumerating them. ",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "decimals": 0,
              "mappings": [
                {
                  "options": {
                    "null": {
                      "index": 0,
                      "text": "N/A"
                    }
                  },
                  "type": "value"
                }
              ],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": null
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "ms"
            },
            "overrides": [

            ]
          },
          "gridPos": {
            "h": 7,
            "w": 9,
            "x": 15,
            "y": 6
          },
          "id": 11,
          "links": [
            {
              "targetBlank": true,
              "title": "ListBlobs ‚Äì Latency Detail",
              "url": "https://dashboards.gitlab.net/d/PqeIQ9Iik/gitaly-feature-latency-detail?from=now-24h&orgId=1&refresh=5m&to=now&var-job=gitaly&var-method=ListBlobs"
            }
          ],
          "options": {
            "colorMode": "background",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "horizontal",
            "reduceOptions": {
              "calcs": [
                "mean"
              ],
              "fields": "/^Value$/",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "10.4.2",
          "targets": [
            {
              "datasource": {
                "type": "prometheus",
                "uid": "PA5EEDCB71676F488"
              },
              "dsType": "influxdb",
              "editorMode": "code",
              "exemplar": false,
              "expr": "avg(1000 * avg(gitaly:grpc_server_handling_seconds:avg5m{job=\"gitaly\", grpc_method=\"ListBlobs\"}))\n",
              "format": "time_series",
              "groupBy": [
                {
                  "params": [
                    "$__interval"
                  ],
                  "type": "time"
                },
                {
                  "params": [
                    "null"
                  ],
                  "type": "fill"
                }
              ],
              "instant": false,
              "interval": "",
              "intervalFactor": 2,
              "legendFormat": "{{ method }}",
              "orderByTime": "ASC",
              "policy": "default",
              "range": true,
              "refId": "A",
              "resultFormat": "time_series",
              "select": [
                [
                  {
                    "params": [
                      "value"
                    ],
                    "type": "field"
                  },
                  {
                    "params": [

                    ],
                    "type": "mean"
                  }
                ]
              ],
              "step": 3600,
              "tags": [

              ]
            }
          ],
          "title": "ListBlobs ‚Äì Average Latency [All Hosts]",
          "type": "stat"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "PA5EEDCB71676F488"
          },
          "description": "",
          "gridPos": {
            "h": 7,
            "w": 7,
            "x": 0,
            "y": 13
          },
          "id": 13,
          "options": {
            "code": {
              "language": "plaintext",
              "showLineNumbers": false,
              "showMiniMap": false
            },
            "content": "#### During `/internal/allowed` Endpoint ‚Äì Retrieving Blob Metadata\n\nTODO: Explain how this RPC is used while checking secrets from the `/internal/allowed` endpoint to retrieve blob metadata for blobs received in a certain `git` push operation.",
            "mode": "markdown"
          },
          "pluginVersion": "10.4.2",
          "type": "text"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "PA5EEDCB71676F488"
          },
          "description": "This panel displays the average latency in milliseconds for all calls to the GetTreeEntries RPC, which is responsible (within the context of the feature) for retrieving blob metadata (i.e. file path and commit sha) for all blobs that were scanned and found to include a leaked secret.",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "decimals": 0,
              "mappings": [

              ],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": null
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "ms"
            },
            "overrides": [

            ]
          },
          "gridPos": {
            "h": 7,
            "w": 17,
            "x": 7,
            "y": 13
          },
          "id": 9,
          "links": [
            {
              "targetBlank": true,
              "title": "GetTreeEntries ‚Äì Latency Detail",
              "url": "https://dashboards.gitlab.net/d/PqeIQ9Iik/gitaly-feature-latency-detail?from=now-24h&orgId=1&refresh=5m&to=now&var-job=gitaly&var-method=GetTreeEntries"
            }
          ],
          "options": {
            "colorMode": "background",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "horizontal",
            "reduceOptions": {
              "calcs": [
                "mean"
              ],
              "fields": "/^Value$/",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "10.4.2",
          "targets": [
            {
              "datasource": {
                "type": "prometheus",
                "uid": "PA5EEDCB71676F488"
              },
              "dsType": "influxdb",
              "editorMode": "code",
              "exemplar": false,
              "expr": "avg(1000 * avg(gitaly:grpc_server_handling_seconds:avg5m{job=\"gitaly\", grpc_method=\"GetTreeEntries\"}))\n",
              "format": "time_series",
              "groupBy": [
                {
                  "params": [
                    "$__interval"
                  ],
                  "type": "time"
                },
                {
                  "params": [
                    "null"
                  ],
                  "type": "fill"
                }
              ],
              "instant": false,
              "interval": "",
              "intervalFactor": 2,
              "legendFormat": "{{ method }}",
              "orderByTime": "ASC",
              "policy": "default",
              "range": true,
              "refId": "A",
              "resultFormat": "time_series",
              "select": [
                [
                  {
                    "params": [
                      "value"
                    ],
                    "type": "field"
                  },
                  {
                    "params": [

                    ],
                    "type": "mean"
                  }
                ]
              ],
              "step": 3600,
              "tags": [

              ]
            }
          ],
          "title": "GetTreeEntries ‚Äì Average Latency",
          "type": "stat"
        }
      ],
      "title": "‚öôÔ∏è Gitaly",
      "type": "row"
    },
    {
      "collapsed": true,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 46
      },
      "id": 5,
      "panels": [

      ],
      "title": "üöÇ Rails",
      "type": "row"
    }
  ],
  "schemaVersion": 39,
  "tags": [
    "secret-detection",
    "pre-receive-secret-detection",
    "secure",
    "gitaly",
    "rails",
    "workhorse",
    "unmanaged"
  ],
  "templating": {
    "list": [

    ]
  },
  "time": {
    "from": "now-24h",
    "to": "now"
  },
  "timepicker": {
  },
  "timezone": "",
  "title": "Pre-receive Secret Detection ‚Äì Overview",
  "uid": "fdk7i56zibv28d",
  "version": 77,
  "weekStart": ""
}