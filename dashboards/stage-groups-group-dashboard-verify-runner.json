{"meta":{"type":"db","canSave":false,"canEdit":true,"canAdmin":false,"canStar":true,"slug":"stage-groups-group-dashboard-verify-runner","url":"/d/stage-groups-runner/stage-groups-group-dashboard-verify-runner","expires":"0001-01-01T00:00:00Z","created":"2020-12-21T09:03:54Z","updated":"2021-09-15T17:16:05Z","updatedBy":"ops-contact@gitlab.com","createdBy":"ops-contact@gitlab.com","version":756,"hasAcl":false,"isFolder":false,"folderId":1494,"folderTitle":"Stage Groups","folderUrl":"/dashboards/f/stage-groups/stage-groups","provisioned":false,"provisionedExternalId":""},"dashboard":{"__inputs":[],"__requires":[],"annotations":{"list":[{"builtIn":1,"datasource":"-- Grafana --","enable":false,"hide":false,"iconColor":"#96D98D","name":"deploy","showIn":0,"tags":["deploy","$environment"],"type":"tags"},{"builtIn":1,"datasource":"-- Grafana --","enable":false,"hide":false,"iconColor":"#FFEE52","name":"canary-deploy","showIn":0,"tags":["deploy","${environment}-cny"],"type":"tags"},{"builtIn":1,"datasource":"-- Grafana --","enable":false,"hide":false,"iconColor":"#CA95E5","name":"feature-flags","showIn":0,"tags":["feature-flag","${environment}"],"type":"tags"}]},"description":"Uploaded by https://gitlab.com/gitlab-com/runbooks/-/jobs/1593537168 at Wed Sep 15 17:16:05 UTC 2021","editable":false,"gnetId":null,"graphTooltip":1,"hideControls":false,"id":null,"links":[{"asDropdown":true,"icon":"dashboard","includeVars":true,"keepTime":true,"tags":"type:api","targetBlank":false,"title":"API Detail","type":"dashboards","url":""},{"asDropdown":true,"icon":"dashboard","includeVars":true,"keepTime":true,"tags":"type:web","targetBlank":false,"title":"Web Detail","type":"dashboards","url":""},{"asDropdown":true,"icon":"dashboard","includeVars":true,"keepTime":true,"tags":"type:git","targetBlank":false,"title":"Git Detail","type":"dashboards","url":""}],"panels":[{"collapse":false,"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":100},"id":2,"panels":[],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"Error Budget (past 28 days)","titleSize":"h6","type":"row"},{"gridPos":{"h":4,"w":6,"x":0,"y":100},"id":3,"options":{"colorMode":"background","fieldOptions":{"calcs":["lastNotNull"],"defaults":{"decimals":2,"thresholds":{"mode":"absolute","steps":[{"color":"red","value":0},{"color":"green","value":0.9995}]},"title":"","unit":"percentunit"},"values":false},"graphMode":"none","justifyMode":"auto","orientation":"vertical"},"pluginVersion":"6.6.1","targets":[{"expr":"# Account for missing metrics that are turned into 0 by `vector(0)`.\nclamp_max(\n  # Number of successful measurements\n  sum by ()(\n    # Reuest with satisfactory apdex\n    label_replace(\n      sum_over_time(\n        gitlab:component:stage_group:execution:apdex:success:rate_1h{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",stage_group=\"runner\"}[28d]\n      ), 'sli_kind', 'apdex', '', '')\n    or\n    # Requests without error\n    label_replace(\n      sum by() (\n        sum_over_time(\n          gitlab:component:stage_group:execution:ops:rate_1h{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",stage_group=\"runner\"}[28d]\n        )\n      )\n      -\n      sum by() (\n        sum_over_time(\n          gitlab:component:stage_group:execution:error:rate_1h{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",stage_group=\"runner\"}[28d]\n        )\n      ), 'sli_kind', 'error', '', '')\n  )\n  /\n  # Number of measurements\n  sum by ()(\n    # Apdex Measurements\n    label_replace(\n      sum_over_time(\n        gitlab:component:stage_group:execution:apdex:weight:score_1h{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",stage_group=\"runner\"}[28d]\n      ),\n    'sli_kind', 'apdex', '', '')\n    or\n    # Requests\n    label_replace(\n      sum_over_time(\n        gitlab:component:stage_group:execution:ops:rate_1h{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",stage_group=\"runner\"}[28d]\n      ),\n    'sli_kind', 'error', '', '')\n  ),\n1)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":3,"legendFormat":"%"}],"title":"Availability","type":"stat"},{"gridPos":{"h":2,"w":6,"x":0,"y":104},"id":4,"options":{"colorMode":"background","fieldOptions":{"calcs":["lastNotNull"],"defaults":{"decimals":"2","mappings":[{"color":"red","from":0,"text":"ü•µ Unhealthy","to":0.9995,"type":2},{"color":"green","from":0.9995,"text":"ü•≥ Healthy","to":1,"type":2}],"thresholds":{"mode":"absolute","steps":[{"color":"red","value":0},{"color":"green","value":0.9995}]},"title":"Target: 99.95%","unit":"none"},"values":false},"graphMode":"none","justifyMode":"auto","orientation":"vertical"},"pluginVersion":"6.6.1","targets":[{"expr":"# Account for missing metrics that are turned into 0 by `vector(0)`.\nclamp_max(\n  # Number of successful measurements\n  sum by ()(\n    # Reuest with satisfactory apdex\n    label_replace(\n      sum_over_time(\n        gitlab:component:stage_group:execution:apdex:success:rate_1h{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",stage_group=\"runner\"}[28d]\n      ), 'sli_kind', 'apdex', '', '')\n    or\n    # Requests without error\n    label_replace(\n      sum by() (\n        sum_over_time(\n          gitlab:component:stage_group:execution:ops:rate_1h{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",stage_group=\"runner\"}[28d]\n        )\n      )\n      -\n      sum by() (\n        sum_over_time(\n          gitlab:component:stage_group:execution:error:rate_1h{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",stage_group=\"runner\"}[28d]\n        )\n      ), 'sli_kind', 'error', '', '')\n  )\n  /\n  # Number of measurements\n  sum by ()(\n    # Apdex Measurements\n    label_replace(\n      sum_over_time(\n        gitlab:component:stage_group:execution:apdex:weight:score_1h{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",stage_group=\"runner\"}[28d]\n      ),\n    'sli_kind', 'apdex', '', '')\n    or\n    # Requests\n    label_replace(\n      sum_over_time(\n        gitlab:component:stage_group:execution:ops:rate_1h{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",stage_group=\"runner\"}[28d]\n      ),\n    'sli_kind', 'error', '', '')\n  ),\n1)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":3,"legendFormat":""}],"title":"","type":"stat"},{"gridPos":{"h":4,"w":6,"x":6,"y":100},"id":5,"options":{"colorMode":"background","fieldOptions":{"calcs":["lastNotNull"],"defaults":{"decimals":0,"thresholds":{"mode":"absolute","steps":[{"color":"red","value":-2419200},{"color":"green","value":0}]},"title":"","unit":"s"},"values":false},"graphMode":"none","justifyMode":"auto","orientation":"vertical"},"pluginVersion":"6.6.1","targets":[{"expr":"# The number of seconds allowed to be spent in 28d\n1209\n-\n(\n  (\n     1 - # Account for missing metrics that are turned into 0 by `vector(0)`.\nclamp_max(\n  # Number of successful measurements\n  sum by ()(\n    # Reuest with satisfactory apdex\n    label_replace(\n      sum_over_time(\n        gitlab:component:stage_group:execution:apdex:success:rate_1h{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",stage_group=\"runner\"}[28d]\n      ), 'sli_kind', 'apdex', '', '')\n    or\n    # Requests without error\n    label_replace(\n      sum by() (\n        sum_over_time(\n          gitlab:component:stage_group:execution:ops:rate_1h{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",stage_group=\"runner\"}[28d]\n        )\n      )\n      -\n      sum by() (\n        sum_over_time(\n          gitlab:component:stage_group:execution:error:rate_1h{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",stage_group=\"runner\"}[28d]\n        )\n      ), 'sli_kind', 'error', '', '')\n  )\n  /\n  # Number of measurements\n  sum by ()(\n    # Apdex Measurements\n    label_replace(\n      sum_over_time(\n        gitlab:component:stage_group:execution:apdex:weight:score_1h{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",stage_group=\"runner\"}[28d]\n      ),\n    'sli_kind', 'apdex', '', '')\n    or\n    # Requests\n    label_replace(\n      sum_over_time(\n        gitlab:component:stage_group:execution:ops:rate_1h{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",stage_group=\"runner\"}[28d]\n      ),\n    'sli_kind', 'error', '', '')\n  ),\n1)\n\n  ) * 2419200\n)\n\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":3,"legendFormat":""}],"title":"Budget remaining","type":"stat"},{"gridPos":{"h":2,"w":6,"x":6,"y":104},"id":6,"options":{"colorMode":"background","fieldOptions":{"calcs":["lastNotNull"],"defaults":{"decimals":"2","mappings":[{"color":"red","from":-2419200,"text":"ü•µ Unhealthy","to":0,"type":2},{"color":"green","from":0,"text":"ü•≥ Healthy","to":1209.5999999998667,"type":2}],"thresholds":{"mode":"absolute","steps":[{"color":"red","value":-2419200},{"color":"green","value":0}]},"title":"28d budget: 20 minutes","unit":"none"},"values":false},"graphMode":"none","justifyMode":"auto","orientation":"vertical"},"pluginVersion":"6.6.1","targets":[{"expr":"# The number of seconds allowed to be spent in 28d\n1209\n-\n(\n  (\n     1 - # Account for missing metrics that are turned into 0 by `vector(0)`.\nclamp_max(\n  # Number of successful measurements\n  sum by ()(\n    # Reuest with satisfactory apdex\n    label_replace(\n      sum_over_time(\n        gitlab:component:stage_group:execution:apdex:success:rate_1h{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",stage_group=\"runner\"}[28d]\n      ), 'sli_kind', 'apdex', '', '')\n    or\n    # Requests without error\n    label_replace(\n      sum by() (\n        sum_over_time(\n          gitlab:component:stage_group:execution:ops:rate_1h{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",stage_group=\"runner\"}[28d]\n        )\n      )\n      -\n      sum by() (\n        sum_over_time(\n          gitlab:component:stage_group:execution:error:rate_1h{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",stage_group=\"runner\"}[28d]\n        )\n      ), 'sli_kind', 'error', '', '')\n  )\n  /\n  # Number of measurements\n  sum by ()(\n    # Apdex Measurements\n    label_replace(\n      sum_over_time(\n        gitlab:component:stage_group:execution:apdex:weight:score_1h{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",stage_group=\"runner\"}[28d]\n      ),\n    'sli_kind', 'apdex', '', '')\n    or\n    # Requests\n    label_replace(\n      sum_over_time(\n        gitlab:component:stage_group:execution:ops:rate_1h{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",stage_group=\"runner\"}[28d]\n      ),\n    'sli_kind', 'error', '', '')\n  ),\n1)\n\n  ) * 2419200\n)\n\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":3,"legendFormat":""}],"title":"","type":"stat"},{"gridPos":{"h":4,"w":6,"x":12,"y":100},"id":7,"options":{"colorMode":"background","fieldOptions":{"calcs":["lastNotNull"],"defaults":{"decimals":0,"thresholds":{"mode":"absolute","steps":[{"color":"green","value":0},{"color":"red","value":1209.5999999998667}]},"title":"","unit":"s"},"values":false},"graphMode":"none","justifyMode":"auto","orientation":"vertical"},"pluginVersion":"6.6.1","targets":[{"expr":"(\n  (\n     1 - # Account for missing metrics that are turned into 0 by `vector(0)`.\nclamp_max(\n  # Number of successful measurements\n  sum by ()(\n    # Reuest with satisfactory apdex\n    label_replace(\n      sum_over_time(\n        gitlab:component:stage_group:execution:apdex:success:rate_1h{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",stage_group=\"runner\"}[28d]\n      ), 'sli_kind', 'apdex', '', '')\n    or\n    # Requests without error\n    label_replace(\n      sum by() (\n        sum_over_time(\n          gitlab:component:stage_group:execution:ops:rate_1h{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",stage_group=\"runner\"}[28d]\n        )\n      )\n      -\n      sum by() (\n        sum_over_time(\n          gitlab:component:stage_group:execution:error:rate_1h{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",stage_group=\"runner\"}[28d]\n        )\n      ), 'sli_kind', 'error', '', '')\n  )\n  /\n  # Number of measurements\n  sum by ()(\n    # Apdex Measurements\n    label_replace(\n      sum_over_time(\n        gitlab:component:stage_group:execution:apdex:weight:score_1h{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",stage_group=\"runner\"}[28d]\n      ),\n    'sli_kind', 'apdex', '', '')\n    or\n    # Requests\n    label_replace(\n      sum_over_time(\n        gitlab:component:stage_group:execution:ops:rate_1h{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",stage_group=\"runner\"}[28d]\n      ),\n    'sli_kind', 'error', '', '')\n  ),\n1)\n\n  ) * 2419200\n)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":3,"legendFormat":""}],"title":"Budget spent","type":"stat"},{"gridPos":{"h":2,"w":6,"x":12,"y":104},"id":8,"options":{"colorMode":"background","fieldOptions":{"calcs":["lastNotNull"],"defaults":{"decimals":"2","mappings":[{"color":"red","from":1209.5999999998667,"text":"ü•µ Unhealthy","to":2419200,"type":2},{"color":"green","from":0,"text":"ü•≥ Healthy","to":1209.5999999998667,"type":2}],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":0},{"color":"red","value":1209.5999999998667}]},"title":"Target: Less than 20 minutes in 28d","unit":"none"},"values":false},"graphMode":"none","justifyMode":"auto","orientation":"vertical"},"pluginVersion":"6.6.1","targets":[{"expr":"(\n  (\n     1 - # Account for missing metrics that are turned into 0 by `vector(0)`.\nclamp_max(\n  # Number of successful measurements\n  sum by ()(\n    # Reuest with satisfactory apdex\n    label_replace(\n      sum_over_time(\n        gitlab:component:stage_group:execution:apdex:success:rate_1h{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",stage_group=\"runner\"}[28d]\n      ), 'sli_kind', 'apdex', '', '')\n    or\n    # Requests without error\n    label_replace(\n      sum by() (\n        sum_over_time(\n          gitlab:component:stage_group:execution:ops:rate_1h{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",stage_group=\"runner\"}[28d]\n        )\n      )\n      -\n      sum by() (\n        sum_over_time(\n          gitlab:component:stage_group:execution:error:rate_1h{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",stage_group=\"runner\"}[28d]\n        )\n      ), 'sli_kind', 'error', '', '')\n  )\n  /\n  # Number of measurements\n  sum by ()(\n    # Apdex Measurements\n    label_replace(\n      sum_over_time(\n        gitlab:component:stage_group:execution:apdex:weight:score_1h{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",stage_group=\"runner\"}[28d]\n      ),\n    'sli_kind', 'apdex', '', '')\n    or\n    # Requests\n    label_replace(\n      sum_over_time(\n        gitlab:component:stage_group:execution:ops:rate_1h{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",stage_group=\"runner\"}[28d]\n      ),\n    'sli_kind', 'error', '', '')\n  ),\n1)\n\n  ) * 2419200\n)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":3,"legendFormat":""}],"title":"","type":"stat"},{"content":"### [Error budget](https://about.gitlab.com/handbook/engineering/error-budgets/)\n\nThese error budget panels show an aggregate of SLIs across all components.\nHowever, not all components have been implemented yet.\n\nThe [handbook](https://about.gitlab.com/handbook/engineering/error-budgets/)\nexplains how these budgets are used.\n\nRead more about how the error budgets are calculated in the\n[stage group dashboard documentation](https://docs.gitlab.com/ee/development/stage_group_dashboards.html#error-budget).\n\nThe error budget is compared to our SLO of 99.95% and is always in\na range of 28 days from the selected end date in Grafana.\n\n### Availability\n\nThe availability shows the percentage of operations labeled with one of the\ncategories owned by Runner with satisfactory completion.\n\n### Budget remaining\n\nThe error budget in minutes is calculated based on the 99.95%.\nThere are 40320 minutes in 28 days, we allow 0.05% of failures, which\nmeans the budget in minutes is 20 minutes.\n\nThe budget remaining shows how many minutes have not been spent in the\npast 28 days.\n\n### Minutes spent\n\nThis shows the total minutes spent over the past 28 days.\n\nFor example, if there were 403200 (28 * 24 * 60) operations in 28 days.\nThis would be 1 every minute. If 10 of those were unsatisfactory, that\nwould mean 10 minutes of the budget were spent.\n","gridPos":{"h":6,"w":6,"x":18,"y":100},"id":9,"mode":"markdown","title":"Info","type":"text"},{"collapse":true,"collapsed":true,"gridPos":{"h":1,"w":24,"x":0,"y":110},"id":10,"panels":[{"columns":[],"datasource":"$PROMETHEUS_DS","description":"Number of failures contributing to the budget send per component and type ","fieldConfig":{"overrides":[{"matcher":{"id":"byName","options":"type"},"properties":[{"id":"links","value":[{"targetBlank":true,"title":"${__value.text} overview: See ${__data.fields.component} SLI for details","url":"https://dashboards.gitlab.net/d/${__value.text}-main"}]}]}]},"gridPos":{"h":10,"w":8,"x":0,"y":111},"id":11,"links":[],"options":{"sortBy":[{"desc":true,"displayName":"failures past 28 days"}]},"styles":null,"targets":[{"expr":"ceil(\n  (\n    sum by (component,violation_type,type) (\n      label_replace(\n        sum by (component,type)(\n          sum_over_time(\n            gitlab:component:stage_group:execution:apdex:weight:score_1h{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",stage_group=\"runner\"}[28d]\n          ) -\n          # Request with satisfactory apdex\n          sum_over_time(\n            gitlab:component:stage_group:execution:apdex:success:rate_1h{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",stage_group=\"runner\"}[28d]\n          )\n        ),\n        'violation_type', 'apdex' , '', ''\n      )\n      or\n      label_replace(\n        sum by (component,type)(\n          sum_over_time(\n            gitlab:component:stage_group:execution:error:rate_1h{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",stage_group=\"runner\"}[28d]\n          )\n        ),\n        'violation_type', 'error' , '', ''\n      )\n    ) \u003e 0\n  ) * 60\n)\n","format":"table","instant":true,"interval":"1m","intervalFactor":3,"legendFormat":"","refId":"A"}],"timeFrom":null,"timeShift":null,"title":"Budget failures","transformations":[{"id":"organize","options":{"excludeByName":{"Time":true},"indexByName":{"Value":3,"component":2,"type":1,"violation_type":0},"renameByName":{"Value":"failures past 28 days"}}}],"type":"table"},{"content":"This table shows the failures that contribute to the spend of the error budget.\nFixing the top item in this table will have the biggest impact on the\nbudget spend.\n\nA failure is one of 2 types:\n\n- **error**: An operation that failed: 500 response, failed background job.\n- **apdex**: This means an operation that succeeded, but did not perform within the set threshold.\n\nSee the [developer documentation](https://gitlab.com/gitlab-org/gitlab/-/blob/master/doc/development/stage_group_dashboards.md#error-budget)\nto learn more about this.\n\nThe component refers to the component in our stack where the violation occurred.\nThe most common ones are:\n\n- **puma**: This component signifies requests handled by rails\n- **sidekiq_execution**: This component signifies background jobs executed by Sidekiq\n\nTo find the endpoint that is attributing to the budget spend and a violation type\nwe can use the logs over a 7 day range. Links for puma and sidekiq are available on the right.\nThese logs lists the endpoints that had the most violations over the past 7 days.\n\nThe \"Other\" row is the sum of all the other violations excluding the top ones\nthat are listed.\n","datasource":null,"gridPos":{"h":10,"w":8,"x":8,"y":111},"id":12,"mode":"markdown","title":"Info","type":"text"},{"content":"##### [Puma Apdex](https://log.gprd.gitlab.net/app/kibana#/visualize/create?type=table\u0026indexPattern=7092c4e2-4eb5-46f2-8305-a7da2edad090\u0026_a=(filters:!((query:(bool:(minimum_should_match:1,should:!((match_phrase:(json.meta.feature_category:runner))))))),query:(language:kuery,query:''),vis:(aggs:!((enabled:!t,id:'1',params:(),schema:metric,type:count),(enabled:!t,params:(field:json.meta.caller_id.keyword,missingBucket:!f,missingBucketLabel:Missing,order:desc,orderBy:'3',otherBucket:!t,otherBucketLabel:Other,size:5),schema:bucket,type:terms),(enabled:!t,id:'3',params:(customLabel:'Operations+over+threshold+(1s)',field:json.duration_s,json:'{\"script\":+\"doc[!'json.duration_s!'].value+\u003e=+1+?+1+:+0\"}'),schema:metric,type:sum),(enabled:!t,id:'4',params:(customLabel:'Operations+over+error+budget+threshold+(5s)',field:json.duration_s,json:'{\"script\":+\"doc[!'json.duration_s!'].value+\u003e=+5+?+1+:+0\"}'),schema:metric,type:sum))))\u0026_g=(time:(from:'now-7d',to:'now'))): slow requests\n\nThis shows the number of requests exceeding the request duration thresholds\nper endpoint over the past 7 days.\n\nThis is the only threshold at the moment. We're discussing making\nit configurable in [this issue](https://gitlab.com/gitlab-com/gl-infra/scalability/-/issues/1099). Let us know\nif you know of an endpoint that would need this kind of customization.\n\n##### [Puma Errors](https://log.gprd.gitlab.net/app/kibana#/visualize/create?type=table\u0026indexPattern=7092c4e2-4eb5-46f2-8305-a7da2edad090\u0026_a=(filters:!((query:(bool:(minimum_should_match:1,should:!((match_phrase:(json.meta.feature_category:runner)))))),(query:(range:(json.status:(gte:500))))),query:(language:kuery,query:''),vis:(aggs:!((enabled:!t,id:'1',params:(),schema:metric,type:count),(enabled:!t,params:(field:json.meta.caller_id.keyword,missingBucket:!f,missingBucketLabel:Missing,order:desc,orderBy:'1',otherBucket:!t,otherBucketLabel:Other,size:5),schema:bucket,type:terms))))\u0026_g=(time:(from:'now-7d',to:'now'))): failing requests\n\nThis shows the number of Rails requests that failed per endpoint over\nthe past 7 days.\n\n##### [Sidekiq Execution Apdex](https://log.gprd.gitlab.net/app/kibana#/visualize/create?type=table\u0026indexPattern=AWNABDRwNDuQHTm2tH6l\u0026_a=(filters:!((query:(bool:(minimum_should_match:1,should:!((match_phrase:(json.meta.feature_category:runner)))))),(query:(match:(json.job_status:(query:done,type:phrase))))),query:(language:kuery,query:''),vis:(aggs:!((enabled:!t,id:'1',params:(),schema:metric,type:count),(enabled:!t,params:(filters:!((input:(language:kuery,query:'json.shard:+\"urgent\"+AND+json.duration_s+\u003e+10'),label:'Jobs+exceeding+10s'),(input:(language:kuery,query:'not+json.shard:+\"urgent\"+AND+json.duration_s+\u003e+300'),label:'Jobs+exceeding+300s'))),schema:split,type:filters),(enabled:!t,params:(field:json.class.keyword,missingBucket:!f,missingBucketLabel:Missing,order:desc,orderBy:'1',otherBucket:!t,otherBucketLabel:Other,size:5),schema:bucket,type:terms))))\u0026_g=(time:(from:'now-7d',to:'now'))): slow jobs\n\nThis shows the number of jobs per worker that took longer than their threshold to\nexecute over the past 7 days.\nFor urgent jobs the threshold is 10s, this is the table on the left.\nFor other jobs the threshold is 300s, this is the table on the right.\n\n##### [Sidekiq Execution Errors](https://log.gprd.gitlab.net/app/kibana#/visualize/create?type=table\u0026indexPattern=AWNABDRwNDuQHTm2tH6l\u0026_a=(filters:!((query:(bool:(minimum_should_match:1,should:!((match_phrase:(json.meta.feature_category:runner)))))),(query:(match:(json.job_status:(query:fail,type:phrase))))),query:(language:kuery,query:''),vis:(aggs:!((enabled:!t,id:'1',params:(),schema:metric,type:count),(enabled:!t,params:(field:json.class.keyword,missingBucket:!f,missingBucketLabel:Missing,order:desc,orderBy:'1',otherBucket:!t,otherBucketLabel:Other,size:5),schema:bucket,type:terms))))\u0026_g=(time:(from:'now-7d',to:'now'))): failing jobs\n\nThis shows the number of jobs per worker that failed over the past 7 days.\nThis includes retries: if a job with a was retried 3 times, before exhausting\nits retries, this counts as 3 failures towards the budget.\n","datasource":null,"gridPos":{"h":10,"w":8,"x":16,"y":111},"id":13,"mode":"markdown","title":"Failure log links","type":"text"}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"Budget spend attribution","titleSize":"h6","type":"row"},{"collapse":false,"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":1000},"id":14,"panels":[],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"üå°Ô∏è Aggregated Service Level Indicators (ùôéùôáùôÑùô®)","titleSize":"h6","type":"row"},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Apdex is a measure of requests that complete within a tolerable period of time for the service. Higher is better.","fill":0,"gridPos":{"h":6,"w":5,"x":0,"y":1001},"id":79474957,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","options":{"dataLinks":[{"targetBlank":true,"title":"ci-runners Service Apdex SLO Analysis","url":"/d/alerts-service_slo_apdex?${__url_time_range}\u0026${__all_variables}\u0026var-type=ci-runners\u0026var-stage=$stage"}]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"6h Degradation SLO (5% of monthly error budget)","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"1h Outage SLO (2% of monthly error budget)","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"SLO","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"ci-runners apdex","color":"#E7D551","zindex":3},{"alias":"ci-runners apdex avg","color":"#5794F2","dashLength":1,"fillBelowTo":"ci-runners apdex","linewidth":1,"spaceLength":1,"zindex":-3},{"alias":"last week","color":"#dddddd80","dashLength":4,"dashes":true,"fill":0,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":2,"zindex":-3}],"spaceLength":10,"stableId":"service-ci-runners-apdex","stack":false,"steppedLine":false,"targets":[{"expr":"min_over_time(gitlab_service_apdex:ratio_5m{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",tier=\"runners\",type=\"ci-runners\"}[$__interval])\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"ci-runners apdex","refId":"A"},{"expr":"(1 - 6 * (1 - avg(slo:min:events:gitlab_service_apdex:ratio{monitor=\"global\",type=\"ci-runners\"})))\n","format":"time_series","interval":"5m","intervalFactor":3,"legendFormat":"6h Degradation SLO (5% of monthly error budget)","refId":"B"},{"expr":"(1 - 14.4 * (1 - avg(slo:min:events:gitlab_service_apdex:ratio{monitor=\"global\",type=\"ci-runners\"})))\n","format":"time_series","interval":"5m","intervalFactor":3,"legendFormat":"1h Outage SLO (2% of monthly error budget)","refId":"C"},{"expr":"avg_over_time(gitlab_service_apdex:ratio_5m{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",tier=\"runners\",type=\"ci-runners\"}[$__interval])\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"ci-runners apdex avg","refId":"D"},{"expr":"clamp_min(\n  gitlab_service_apdex:ratio_5m{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",tier=\"runners\",type=\"ci-runners\"} offset 1w\n,\n  scalar(min((1 - 14.4 * (1 - avg(slo:min:events:gitlab_service_apdex:ratio{monitor=\"global\",type=\"ci-runners\"})))\n))\n)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"last week","refId":"E"}],"title":"ci-runners Service Apdex","tooltip":{"shared":true,"sort":1,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"percentunit","label":"Apdex %","logBase":1,"max":1,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"gridPos":{"h":1,"w":5,"x":0,"y":1007},"id":16,"options":{"colorMode":"background","fieldOptions":{"calcs":["lastNotNull"],"defaults":{"mappings":[{"from":"0","id":0,"op":"=","text":"Healthy","to":"0","type":2,"value":"0"},{"from":"1","id":1,"op":"=","text":"Warning üî•","to":"1","type":2,"value":"1"},{"from":"2","id":2,"op":"=","text":"Warning üî•","to":"2","type":2,"value":"2"},{"from":"3","id":3,"op":"=","text":"Degraded üî•","to":"3","type":2,"value":"3"},{"from":"4","id":4,"op":"=","text":"Warning ü•µ","to":"4","type":2,"value":"4"},{"from":"5","id":5,"op":"=","text":"Warning üî•ü•µ","to":"5","type":2,"value":"5"},{"from":"6","id":6,"op":"=","text":"Warning üî•ü•µ","to":"6","type":2,"value":"6"},{"from":"7","id":7,"op":"=","text":"Degraded üî•ü•µ","to":"7","type":2,"value":"7"},{"from":"8","id":8,"op":"=","text":"Warning ü•µ","to":"8","type":2,"value":"8"},{"from":"9","id":9,"op":"=","text":"Warning üî•ü•µ","to":"9","type":2,"value":"9"},{"from":"10","id":10,"op":"=","text":"Warning üî•ü•µ","to":"10","type":2,"value":"10"},{"from":"11","id":11,"op":"=","text":"Degraded üî•ü•µ","to":"11","type":2,"value":"11"},{"from":"12","id":12,"op":"=","text":"Degraded ü•µ","to":"12","type":2,"value":"12"},{"from":"13","id":13,"op":"=","text":"Degraded üî•ü•µ","to":"13","type":2,"value":"13"},{"from":"14","id":14,"op":"=","text":"Degraded üî•ü•µ","to":"14","type":2,"value":"14"},{"from":"15","id":15,"op":"=","text":"Degraded üî•ü•µ","to":"15","type":2,"value":"15"}],"nullValueMode":"connected","thresholds":{"mode":"absolute","steps":[{"color":"black","value":0},{"color":"orange","value":1},{"color":"orange","value":2},{"color":"red","value":3},{"color":"orange","value":4},{"color":"orange","value":5},{"color":"orange","value":6},{"color":"red","value":7},{"color":"orange","value":8},{"color":"orange","value":9},{"color":"orange","value":10},{"color":"red","value":11},{"color":"red","value":12},{"color":"red","value":13},{"color":"red","value":14},{"color":"red","value":15}]},"title":"Status","unit":"none"},"values":false},"graphMode":"none","justifyMode":"auto","orientation":"vertical"},"pluginVersion":"6.6.1","targets":[{"expr":"sum(\n  label_replace(\n    vector(0) and on() (gitlab_service_apdex:ratio_1h{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",tier=\"runners\",type=\"ci-runners\"}),\n    \"period\", \"na\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(1) and on () (gitlab_service_apdex:ratio_5m{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",tier=\"runners\",type=\"ci-runners\"} \u003c on(tier, type) group_left() (1 - (14.4 * (1 - slo:min:events:gitlab_service_apdex:ratio{monitor=\"global\",type=\"ci-runners\"})))),\n    \"period\", \"5m\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(2) and on () (gitlab_service_apdex:ratio_1h{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",tier=\"runners\",type=\"ci-runners\"} \u003c on(tier, type) group_left() (1 - (14.4 * (1 - slo:min:events:gitlab_service_apdex:ratio{monitor=\"global\",type=\"ci-runners\"})))),\n    \"period\", \"1h\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(4) and on () (gitlab_service_apdex:ratio_30m{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",tier=\"runners\",type=\"ci-runners\"} \u003c on(tier, type) group_left() (1 - (6 * (1 - slo:min:events:gitlab_service_apdex:ratio{monitor=\"global\",type=\"ci-runners\"})))),\n    \"period\", \"30m\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(8) and on () (gitlab_service_apdex:ratio_6h{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",tier=\"runners\",type=\"ci-runners\"} \u003c on(tier, type) group_left() (1 - (6 * (1 - slo:min:events:gitlab_service_apdex:ratio{monitor=\"global\",type=\"ci-runners\"})))),\n    \"period\", \"6h\", \"\", \"\"\n  )\n)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":3,"legendFormat":"ci-runners Service | Latency/Apdex"}],"title":"","type":"stat"},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Error rates are a measure of unhandled service exceptions per second. Client errors are excluded when possible. Lower is better","fill":0,"gridPos":{"h":6,"w":5,"x":5,"y":1001},"id":1563711449,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","options":{"dataLinks":[{"targetBlank":true,"title":"ci-runners Service Error-Rate SLO Analysis","url":"/d/alerts-service_slo_error?${__url_time_range}\u0026${__all_variables}\u0026var-type=ci-runners\u0026var-stage=$stage"}]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"6h Degradation SLO (5% of monthly error budget)","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"1h Outage SLO (2% of monthly error budget)","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"ci-runners error ratio","color":"#E7D551","fillBelowTo":"ci-runners error ratio avg","zindex":3},{"alias":"ci-runners error ratio avg","color":"#5794F2","dashLength":1,"fillGradient":10,"linewidth":1,"spaceLength":1,"zindex":-3},{"alias":"last week","color":"#dddddd80","dashLength":4,"dashes":true,"fill":0,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":2,"zindex":-3}],"spaceLength":10,"stableId":"service-ci-runners-error-rate","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_max(\n  max_over_time(gitlab_service_errors:ratio_5m{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",tier=\"runners\",type=\"ci-runners\"}[$__interval])\n,\n  1\n)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"ci-runners error ratio","refId":"A"},{"expr":"(6 * avg(slo:max:events:gitlab_service_errors:ratio{monitor=\"global\",type=\"ci-runners\"}))\n","format":"time_series","interval":"5m","intervalFactor":3,"legendFormat":"6h Degradation SLO (5% of monthly error budget)","refId":"B"},{"expr":"(14.4 * avg(slo:max:events:gitlab_service_errors:ratio{monitor=\"global\",type=\"ci-runners\"}))\n","format":"time_series","interval":"5m","intervalFactor":3,"legendFormat":"1h Outage SLO (2% of monthly error budget)","refId":"C"},{"expr":"clamp_max(\n  avg_over_time(gitlab_service_errors:ratio_5m{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",tier=\"runners\",type=\"ci-runners\"}[$__interval])\n,\n  1\n)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"ci-runners error ratio avg","refId":"D"},{"expr":"clamp_max(\n  gitlab_service_errors:ratio_5m{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",tier=\"runners\",type=\"ci-runners\"} offset 1w\n,\n  scalar(max((14.4 * avg(slo:max:events:gitlab_service_errors:ratio{monitor=\"global\",type=\"ci-runners\"}))\n))\n)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"last week","refId":"E"}],"title":"ci-runners Service Error Ratio","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"percentunit","label":"Error %","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"gridPos":{"h":1,"w":5,"x":5,"y":1007},"id":18,"options":{"colorMode":"background","fieldOptions":{"calcs":["lastNotNull"],"defaults":{"mappings":[{"from":"0","id":0,"op":"=","text":"Healthy","to":"0","type":2,"value":"0"},{"from":"1","id":1,"op":"=","text":"Warning üî•","to":"1","type":2,"value":"1"},{"from":"2","id":2,"op":"=","text":"Warning üî•","to":"2","type":2,"value":"2"},{"from":"3","id":3,"op":"=","text":"Degraded üî•","to":"3","type":2,"value":"3"},{"from":"4","id":4,"op":"=","text":"Warning ü•µ","to":"4","type":2,"value":"4"},{"from":"5","id":5,"op":"=","text":"Warning üî•ü•µ","to":"5","type":2,"value":"5"},{"from":"6","id":6,"op":"=","text":"Warning üî•ü•µ","to":"6","type":2,"value":"6"},{"from":"7","id":7,"op":"=","text":"Degraded üî•ü•µ","to":"7","type":2,"value":"7"},{"from":"8","id":8,"op":"=","text":"Warning ü•µ","to":"8","type":2,"value":"8"},{"from":"9","id":9,"op":"=","text":"Warning üî•ü•µ","to":"9","type":2,"value":"9"},{"from":"10","id":10,"op":"=","text":"Warning üî•ü•µ","to":"10","type":2,"value":"10"},{"from":"11","id":11,"op":"=","text":"Degraded üî•ü•µ","to":"11","type":2,"value":"11"},{"from":"12","id":12,"op":"=","text":"Degraded ü•µ","to":"12","type":2,"value":"12"},{"from":"13","id":13,"op":"=","text":"Degraded üî•ü•µ","to":"13","type":2,"value":"13"},{"from":"14","id":14,"op":"=","text":"Degraded üî•ü•µ","to":"14","type":2,"value":"14"},{"from":"15","id":15,"op":"=","text":"Degraded üî•ü•µ","to":"15","type":2,"value":"15"}],"nullValueMode":"connected","thresholds":{"mode":"absolute","steps":[{"color":"black","value":0},{"color":"orange","value":1},{"color":"orange","value":2},{"color":"red","value":3},{"color":"orange","value":4},{"color":"orange","value":5},{"color":"orange","value":6},{"color":"red","value":7},{"color":"orange","value":8},{"color":"orange","value":9},{"color":"orange","value":10},{"color":"red","value":11},{"color":"red","value":12},{"color":"red","value":13},{"color":"red","value":14},{"color":"red","value":15}]},"title":"Status","unit":"none"},"values":false},"graphMode":"none","justifyMode":"auto","orientation":"vertical"},"pluginVersion":"6.6.1","targets":[{"expr":"sum (\n  label_replace(\n    vector(0) and on() (gitlab_service_errors:ratio_1h{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",tier=\"runners\",type=\"ci-runners\"}),\n    \"period\", \"na\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(1) and on() (gitlab_service_errors:ratio_5m{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",tier=\"runners\",type=\"ci-runners\"} \u003e on(tier, type) group_left() (14.4 * slo:max:events:gitlab_service_errors:ratio{monitor=\"global\",type=\"ci-runners\"})),\n    \"period\", \"5m\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(2) and on() (gitlab_service_errors:ratio_1h{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",tier=\"runners\",type=\"ci-runners\"} \u003e on(tier, type) group_left() (14.4 * slo:max:events:gitlab_service_errors:ratio{monitor=\"global\",type=\"ci-runners\"})),\n    \"period\", \"1h\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(4) and on() (gitlab_service_errors:ratio_30m{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",tier=\"runners\",type=\"ci-runners\"} \u003e on(tier, type) group_left() (6 * slo:max:events:gitlab_service_errors:ratio{monitor=\"global\",type=\"ci-runners\"})),\n    \"period\", \"30m\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(8) and on() (gitlab_service_errors:ratio_6h{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",tier=\"runners\",type=\"ci-runners\"} \u003e on(tier, type) group_left() (6 * slo:max:events:gitlab_service_errors:ratio{monitor=\"global\",type=\"ci-runners\"})),\n    \"period\", \"6h\", \"\", \"\"\n  )\n)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":3,"legendFormat":"ci-runners Service | Errors"}],"title":"","type":"stat"},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"The operation rate is the sum total of all requests being handle for all components within this service. Note that a single user request can lead to requests to multiple components. Higher is busier.","fill":0,"gridPos":{"h":7,"w":5,"x":10,"y":1001},"id":3076411492,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"ci-runners RPS","color":"#E7D551","zindex":3},{"alias":"last week","color":"#dddddd80","dashLength":4,"dashes":true,"fill":0,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":2,"zindex":-3},{"alias":"upper normal","color":"#73BF69","dashLength":8,"dashes":true,"fillBelowTo":"lower normal","legend":false,"lines":false,"linewidth":1,"nullPointMode":"connected","spaceLength":8,"zindex":-3},{"alias":"lower normal","color":"#73BF69","dashLength":8,"dashes":true,"legend":false,"lines":false,"linewidth":1,"nullPointMode":"connected","spaceLength":8,"zindex":-3}],"spaceLength":10,"stableId":"service-ci-runners-ops-rate","stack":false,"steppedLine":false,"targets":[{"expr":"avg_over_time(gitlab_service_ops:rate_5m{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",tier=\"runners\",type=\"ci-runners\"}[$__interval])\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"ci-runners RPS","refId":"A"},{"expr":"gitlab_service_ops:rate_5m{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",tier=\"runners\",type=\"ci-runners\"} offset 1w\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"last week","refId":"B"},{"expr":"clamp_min(\n  avg by (type) (\n    gitlab_service_ops:rate:prediction{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",tier=\"runners\",type=\"ci-runners\"}\n    + (1) *\n    gitlab_service_ops:rate:stddev_over_time_1w{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",tier=\"runners\",type=\"ci-runners\"}\n  ),\n  0\n)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"upper normal","refId":"C"},{"expr":"clamp_min(\n  avg by (type) (\n    gitlab_service_ops:rate:prediction{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",tier=\"runners\",type=\"ci-runners\"}\n    + (-1) *\n    gitlab_service_ops:rate:stddev_over_time_1w{environment=\"$environment\",monitor=\"global\",stage=\"$stage\",tier=\"runners\",type=\"ci-runners\"}\n  ),\n  0\n)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"lower normal","refId":"D"}],"title":"ci-runners Service RPS - Requests per Second","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Operations per Second","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Saturation is a measure of what ratio of a finite resource is currently being utilized. Lower is better.","fill":0,"gridPos":{"h":7,"w":6,"x":15,"y":1001},"id":1217942947,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stableId":"service-utilization","stack":false,"steppedLine":false,"targets":[{"expr":"max(\n  max_over_time(\n    gitlab_component_saturation:ratio{environment=\"$environment\",stage=\"$stage\",tier=\"runners\",type=\"ci-runners\"}[$__interval]\n  )\n) by (component)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ component }} component","refId":"A"}],"title":"Saturation","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"percentunit","label":"Saturation %","logBase":1,"max":1,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"description":"","gridPos":{"h":7,"w":3,"x":21,"y":1001},"headings":false,"id":21,"limit":10,"pluginVersion":"7.2.0","query":"","recent":false,"search":true,"starred":false,"tags":["managed","type:ci-runners"],"title":"","type":"dashlist"},{"collapse":false,"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":2000},"id":22,"panels":[],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"Runners saturation","titleSize":"h6","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"","fill":0,"gridPos":{"h":10,"w":8,"x":0,"y":2001},"id":23,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[{"alias":"/^Hard SLO/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/^Soft SLO/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2}],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by (shard) (\n  gitlab_runner_jobs{environment=\"$environment\", stage=\"$stage\", job=\"runners-manager\", instance=~\"${runner_manager:pipe}\"}\n) / sum by (shard) (\n  gitlab_runner_concurrent{environment=\"$environment\", stage=\"$stage\", job=\"runners-manager\", instance=~\"${runner_manager:pipe}\"}\n)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ shard }}","refId":"A"},{"expr":"0.85","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"Soft SLO","refId":"B"},{"expr":"0.9","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"Hard SLO","refId":"C"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Runner saturation of concurrent by shard","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"","fill":0,"gridPos":{"h":10,"w":8,"x":8,"y":2001},"id":24,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[{"alias":"/^Hard SLO/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/^Soft SLO/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2}],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by (instance) (\n  gitlab_runner_jobs{environment=\"$environment\", stage=\"$stage\", job=\"runners-manager\", instance=~\"${runner_manager:pipe}\"}\n) / sum by (instance) (\n  gitlab_runner_concurrent{environment=\"$environment\", stage=\"$stage\", job=\"runners-manager\", instance=~\"${runner_manager:pipe}\"}\n)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ instance }}","refId":"A"},{"expr":"0.85","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"Soft SLO","refId":"B"},{"expr":"0.9","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"Hard SLO","refId":"C"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Runner saturation of concurrent by instance","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"","fill":0,"gridPos":{"h":10,"w":8,"x":16,"y":2001},"id":25,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[{"alias":"/^Hard SLO/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/^Soft SLO/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2}],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by (instance,runner) (\n  gitlab_runner_jobs{environment=\"$environment\", stage=\"$stage\", job=\"runners-manager\", instance=~\"${runner_manager:pipe}\"}\n) / sum by (instance,runner) (\n  gitlab_runner_limit{environment=\"$environment\", stage=\"$stage\", job=\"runners-manager\", instance=~\"${runner_manager:pipe}\"}\n)\n","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"{{ instance }} - {{ runner }}","refId":"A"},{"expr":"0.85","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"Soft SLO","refId":"B"},{"expr":"0.9","format":"time_series","interval":"1m","intervalFactor":3,"legendFormat":"Hard SLO","refId":"C"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Runner saturation of limit by instance,runner","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"content":"Made with ‚ù§Ô∏è and [Grafonnet](https://github.com/grafana/grafonnet-lib). [Contribute to this dashboard on GitLab.com](https://gitlab.com/gitlab-com/runbooks/blob/master/dashboards)\n","datasource":null,"gridPos":{"h":2,"w":24,"x":0,"y":110000},"id":26,"mode":"markdown","title":"Source","type":"text"}],"refresh":"","rows":[],"schemaVersion":16,"style":"light","tags":["managed","stage-groups","feature_category"],"templating":{"list":[{"current":{"text":"Global","value":"Global"},"hide":0,"label":null,"name":"PROMETHEUS_DS","options":[],"query":"prometheus","refresh":1,"regex":"","type":"datasource"},{"allValue":null,"current":{"text":"gprd","value":"gprd"},"datasource":"$PROMETHEUS_DS","hide":0,"includeAll":false,"label":null,"multi":false,"name":"environment","options":[],"query":"label_values(gitlab_service_ops:rate, environment)","refresh":1,"regex":"","sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":null,"current":{"text":"main","value":"main"},"hide":0,"includeAll":false,"label":"","multi":false,"name":"stage","options":[{"text":"main","value":"main"},{"text":"cny","value":"cny"},{"text":"","value":""}],"query":"main,cny,","refresh":0,"type":"custom"},{"allValue":null,"current":{},"datasource":"$PROMETHEUS_DS","hide":0,"includeAll":true,"label":null,"multi":true,"name":"shard","options":[],"query":"label_values(gitlab_runner_version_info{job=~\".*\",job!~\"omnibus-runners|gprd-runner\",shard!=\"default\"}, shard)\n","refresh":1,"regex":"","sort":true,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":null,"current":{},"datasource":"$PROMETHEUS_DS","hide":0,"includeAll":true,"label":null,"multi":true,"name":"runner_manager","options":[],"query":"query_result(label_replace(gitlab_runner_version_info{shard=~\"$shard\"}, \"fqdn\", \"$1.*\", \"instance\", \"(.*):[0-9]+$\"))\n","refresh":1,"regex":"/fqdn=\"([^\"]+)\"/","sort":true,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false}]},"time":{"from":"now-6h/m","to":"now/m"},"timepicker":{"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"utc","title":"stage-groups: Group dashboard: verify (Runner)","uid":"stage-groups-runner","version":756}}